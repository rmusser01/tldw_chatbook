TLDW_CHATBOOK TEST RESULTS
Generated at: 2025-06-28 21:13:12
Total duration: 133.71s
================================================================================

OVERALL SUMMARY
Total tests: 767
Passed: 572
Failed: 121
Skipped: 40
Errors: 34

DETAILED RESULTS BY DIRECTORY
================================================================================

Directory: Utils
Duration: 4.59s
Passed: 29, Failed: 3, Skipped: 0, Errors: 0

Failures:

1. FAILED Tests/Utils/test_optional_deps.py::test_embeddings_rag_deps_missing - ...
----------------------------------------

2. FAILED Tests/Utils/test_path_validation_properties.py::TestFilenameValidationProperties::test_safe_filenames_preserve_content
----------------------------------------

3. FAILED Tests/Utils/test_path_validation_properties.py::TestSafeJoinPathProperties::test_safe_components_join_successfully
3 failed, 29 passed, 1 warning in 3.61s
----------------------------------------

4. Tests/Utils/test_optional_deps.py::test_embeddings_rag_deps_missing: Tests/Utils/test_optional_deps.py:101: in test_embeddings_rag_deps_missing
    from tldw_chatbook.Utils.optional_deps import DEPENDENCIES_AVAILABLE, check_embeddings_rag_deps
tldw_chatbook/Utils/optional_deps.py:5: in <module>
    from typing import Dict, Any, Optional, Callable
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/typing.py:23: in <module>
    import collections
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/collections/__init__.py:1347: in <module>
    class UserString(_collections_abc.Sequence):
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/collections/__init__.py:1447: in UserString
    def count(self, sub, start=0, end=_sys.maxsize):
                                      ^^^^^^^^^^^^
E   AttributeError: module 'sys' has no attribute 'maxsize'
----------------------------------------

5. Tests/Utils/test_path_validation_properties.py::TestFilenameValidationProperties::test_safe_filenames_preserve_content: Tests/Utils/test_path_validation_properties.py:113: in test_safe_filenames_preserve_content
    def test_safe_filenames_preserve_content(self, filename):
               ^^^^^^^
Tests/Utils/test_path_validation_properties.py:123: in test_safe_filenames_preserve_content
    result = validate_filename(filename)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Utils/path_validation.py:82: in validate_filename
    raise ValueError("Filename cannot contain parent directory references")
E   ValueError: Filename cannot contain parent directory references
E   Falsifying example: test_safe_filenames_preserve_content(
E       self=<Tests.Utils.test_path_validation_properties.TestFilenameValidationProperties object at 0x105852cc0>,
E       filename='0..',
E   )
----------------------------------------

6. Tests/Utils/test_path_validation_properties.py::TestSafeJoinPathProperties::test_safe_components_join_successfully: Tests/Utils/test_path_validation_properties.py:162: in test_safe_components_join_successfully
    def test_safe_components_join_successfully(self, components):
               ^^^^^^^
Tests/Utils/test_path_validation_properties.py:175: in test_safe_components_join_successfully
    result = safe_join_path(base_dir, *components)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Utils/path_validation.py:124: in safe_join_path
    validate_filename(path_component)
tldw_chatbook/Utils/path_validation.py:82: in validate_filename
    raise ValueError("Filename cannot contain parent directory references")
E   ValueError: Filename cannot contain parent directory references
E   Falsifying example: test_safe_components_join_successfully(
E       self=<Tests.Utils.test_path_validation_properties.TestSafeJoinPathProperties object at 0x105890c50>,
E       components=['0..'],
E   )
----------------------------------------

================================================================================

Directory: DB
Duration: 2.33s
Passed: 69, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: Web_Scraping
Duration: 10.95s
Passed: 64, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: ChaChaNotesDB
Duration: 3.18s
Passed: 57, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: Media_DB
Duration: 5.04s
Passed: 46, Failed: 0, Skipped: 0, Errors: 6

Failures:

1. ==================================== ERRORS ====================================
----------------------------------------

2. _ ERROR at teardown of TestClientSyncEngineIntegration.test_push_pull_basic_flow _
Tests/Media_DB/test_sync_client_integration.py:164: in client_db
    db.close()
    ^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'close'
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

3. 2025-06-28 21:11:23.690 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpl0iod593.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:23.690 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpl0iod593.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpa6mjw1cl.db
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50990
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'test_keyword' UUID 6fb882e0-f09e-4da3-a36d-da65ca923c69
----------------------------------------

4. _ ERROR at teardown of TestClientSyncEngineIntegration.test_conflict_resolution_lww _
Tests/Media_DB/test_sync_client_integration.py:164: in client_db
    db.close()
    ^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'close'
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

5. 2025-06-28 21:11:24.201 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpg4da6we0.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:24.201 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpg4da6we0.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:24.201 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:24.201 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmps26ejjco.db
2025-06-28 21:11:24.201 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50991
2025-06-28 21:11:24.201 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:24.202 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'original' UUID 5bcd8985-8849-460b-bb71-ee1369703547
2025-06-28 21:11:24.202 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:24.202 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:24.202 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:50991/sync/send
----------------------------------------

6. 2025-06-28 21:11:24.206 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
----------------------------------------

7. 2025-06-28 21:11:24.211 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpq2zsjw9v.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:24.211 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpq2zsjw9v.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:24.211 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client2'.
2025-06-28 21:11:24.211 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpdozk_jop.db
2025-06-28 21:11:24.211 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50991
2025-06-28 21:11:24.211 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------------------

8. _ ERROR at teardown of TestClientSyncEngineIntegration.test_sync_with_deletions _
Tests/Media_DB/test_sync_client_integration.py:164: in client_db
    db.close()
    ^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'close'
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

9. 2025-06-28 21:11:24.718 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpr3wsuqpu.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:24.718 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpr3wsuqpu.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmppzdxvs02.db
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50993
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'test_keyword' UUID b69cfade-2f68-4c20-850f-f199b47673de
----------------------------------------

10. _ ERROR at teardown of TestClientSyncEngineIntegration.test_network_error_handling _
Tests/Media_DB/test_sync_client_integration.py:164: in client_db
    db.close()
    ^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'close'
----------------------------- Captured stderr call -----------------------------
----------------------------------------

11. 2025-06-28 21:11:25.232 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp28z38kyl.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:25.232 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp28z38kyl.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:25.232 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'test_client'.
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpd_wyzbzj.db
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:99999
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'test' UUID 54c4b6f7-cde1-4775-b2f4-01af1ccad744
2025-06-28 21:11:25.233 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:25.233 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:99999/sync/send
----------------------------------------

12. _ ERROR at teardown of TestClientSyncEngineIntegration.test_idempotent_operations _
Tests/Media_DB/test_sync_client_integration.py:164: in client_db
    db.close()
    ^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'close'
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

13. 2025-06-28 21:11:25.274 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpsc1g5pz3.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:25.275 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpsc1g5pz3.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:25.275 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:25.275 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpxzm6w2bv.db
2025-06-28 21:11:25.275 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50994
2025-06-28 21:11:25.275 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:25.276 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'idempotent_test' UUID 21df07f7-8f73-49f4-a576-9d528fd315e0
2025-06-28 21:11:25.276 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.276 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:25.276 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:50994/sync/send
----------------------------------------

14. 2025-06-28 21:11:25.278 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
2025-06-28 21:11:25.278 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.278 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:25.278 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:50994/sync/send
----------------------------------------

15. 2025-06-28 21:11:25.279 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
2025-06-28 21:11:25.279 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.279 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:25.279 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:50994/sync/send
----------------------------------------

16. 2025-06-28 21:11:25.279 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
----------------------------------------

17. 2025-06-28 21:11:25.285 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpi1j8gjd9.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:25.285 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpi1j8gjd9.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:25.285 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client2'.
2025-06-28 21:11:25.285 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp83njm482.db
2025-06-28 21:11:25.285 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50994
2025-06-28 21:11:25.285 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------------------

18. _____ ERROR at teardown of TestSyncEnginePerformance.test_large_batch_sync _____
Tests/Media_DB/test_sync_client_integration.py:164: in client_db
    db.close()
    ^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'close'
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

19. 2025-06-28 21:11:25.792 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpdn_pcmjm.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:25.792 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpdn_pcmjm.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpmowd13vf.db
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50998
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_0' UUID b5f2901a-49c5-43ef-8f7e-f0b8635f6467
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_1' UUID 7c2263e4-d51c-479e-8368-ec38eb9eaa73
2025-06-28 21:11:25.793 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_2' UUID a9df149c-3af2-4653-8327-273eb1471256
2025-06-28 21:11:25.793 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_3' UUID fb06bb80-3d9b-416e-9181-25197ad1dc90
2025-06-28 21:11:25.793 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_4' UUID 6ac893ac-d96b-4dec-923b-921d66cb23d4
2025-06-28 21:11:25.793 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_5' UUID af9bf03f-ae16-4004-a971-30993bd488c2
2025-06-28 21:11:25.794 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_6' UUID 1fb00484-11cd-411d-8d76-9593d73b4e45
2025-06-28 21:11:25.794 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_7' UUID 439b628a-5012-4f49-baf0-3787b2116139
2025-06-28 21:11:25.794 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_8' UUID 42e53d4a-20e0-4ce9-af52-3ac3b25a33ec
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_9' UUID d87f99f4-caa9-49dd-b58a-7620716ab90f
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_10' UUID 86e99db4-cc20-4477-8de9-605617c98919
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_11' UUID 2e72aac9-0f17-40ee-9357-fa78995a2b04
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_12' UUID 70a49383-aae5-4598-ad33-b8f83e96468e
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_13' UUID 708eab19-2f3b-4544-89ee-d74e926514ac
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_14' UUID da1c0beb-36ab-489c-8349-9cda94f4fc10
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_15' UUID fd135c70-bc3c-4272-a6e3-b0b34065b3f5
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_16' UUID 90d9b49f-2e46-4abe-8760-12cd87075308
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_17' UUID 58b958b9-a8c8-43ad-a608-f90993a9b801
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_18' UUID 21433876-1025-4bc6-9efb-7cbbe208b15d
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_19' UUID c4b81c19-0a48-4ea2-a65e-a505653f614d
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_20' UUID 894276b3-df49-4d9e-a56a-29c24f4b6ded
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_21' UUID e3dcd0a1-33a6-4467-b552-54e52b62b7af
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_22' UUID fec51ca4-c0e0-40c2-b54f-42efce4717a4
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_23' UUID 6a02b983-2294-43ed-bfa1-6f61579c84b5
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_24' UUID b6e3e719-0ddf-412d-a0b8-3fa750be7e72
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_25' UUID 52be4128-6d8b-47ce-9f9e-6647e2e5078f
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_26' UUID 54c26b0f-9288-4fe0-857b-16ff9df4cd69
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_27' UUID b0aa5f13-1ae3-4971-b53c-21b967410b68
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_28' UUID 967e0964-861b-41e3-a866-19451eccf124
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_29' UUID c7d04a77-923f-4b8e-8cd5-65c8e2499c1e
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_30' UUID 0e694aad-325f-4577-b1b2-2646b40e47b8
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_31' UUID 73b7dbba-c573-43cb-9012-d3141e68c1d9
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_32' UUID e62cebf1-ea76-4a9a-a601-2873c8076110
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_33' UUID 7e1b6d7c-e0c7-4a0a-aef2-9cabe822f7d5
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_34' UUID b9a535bc-cf45-465e-a84b-637a90db7c1a
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_35' UUID cd9c3402-a606-48a7-be6a-cdc81858ec81
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_36' UUID c2747111-3b1d-4a23-afd0-c65ebd2faf56
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_37' UUID c3dfbb8f-629b-459d-b729-306ab10bff2e
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_38' UUID 206cbf5f-96ad-4d5f-9c01-2340c03d7cff
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_39' UUID 6d0380a2-eb27-41de-a05c-580d3b556e3a
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_40' UUID 0833b42d-5450-4ec5-8715-9c8b47232ae9
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_41' UUID 4f1e7513-2ebe-4dc0-8ee6-ce293d3bdeb1
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_42' UUID ab5a4f22-e1c6-4508-ba41-dd0dd85df6e4
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_43' UUID d9fb5cc6-4ac1-4483-8ce2-8cae885a02bf
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_44' UUID d159ec82-8907-40bc-a9e7-d5b41b6a7b0f
2025-06-28 21:11:25.801 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_45' UUID 0f0ac445-331d-4d17-b605-d7a840daa0e9
2025-06-28 21:11:25.801 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_46' UUID 9ec0ea07-e4ef-4bd5-bb3b-82ba8934b0cc
2025-06-28 21:11:25.801 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_47' UUID 175f7ece-0778-4c39-994c-b33475fd3da1
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_48' UUID ecd9a087-4034-4d49-bef2-b0a2fd68a501
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_49' UUID 9fc951db-f11c-43df-9691-f53147272631
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_50' UUID 5505c6c1-61ff-441f-9e4a-0ebfdb98908c
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_51' UUID 96daecc5-06ea-456c-b3cc-69a674423c76
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_52' UUID 22485574-86ec-4c52-90f5-9086eb80f7df
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_53' UUID b5bd2350-bb5c-4bb9-aa90-4827a11e1783
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_54' UUID 4a0955d7-acda-4a3e-85c8-783fdbd6146f
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_55' UUID 3264d2ed-249b-4789-ac19-281482582a7a
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_56' UUID d63bd2ee-2931-41e3-8baf-6c83af5a330a
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_57' UUID f69181d5-1a4e-4880-bf29-48dd05072199
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_58' UUID 4824c7b8-59d0-43d1-8a16-657d64d1e4f3
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_59' UUID 2482f49d-9ca9-42fb-bb75-c138780838b1
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_60' UUID fdbe70ad-0260-4e07-89c2-971ad8098a2c
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_61' UUID bcccd698-ba12-4002-b5fe-7df7d2f49c2e
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_62' UUID ad1d8e3f-4042-4bdc-8246-147f7aabec22
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_63' UUID de5f5a04-9a44-44fc-bf79-c580ca55f5fd
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_64' UUID 35dafe7e-ebeb-4c81-81d1-b183b5212a80
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_65' UUID f8b5a791-4ad5-4ee4-9cee-0b28947478ed
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_66' UUID 62e4a2a4-73d2-4521-a724-68d9baabce32
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_67' UUID 365333ed-ed61-4d60-9abf-f5b80b2f6a65
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_68' UUID 2aa2fcf7-d32a-4077-8d19-fd44de1bf6a3
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_69' UUID a0d78c01-d69f-49a0-946e-1b07dc8c3d5a
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_70' UUID 2a11cede-10a3-4b19-bb0f-9516e2ced0af
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_71' UUID 5a3db7ab-9982-407d-9add-e25c04591171
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_72' UUID cd005106-d452-4390-96d5-ff74100a4a39
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_73' UUID 7fa3beb0-5fce-4327-a717-cc9e5cce7e3c
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_74' UUID c54e1e2e-cc31-4bb2-a943-6074c83b21bd
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_75' UUID a4929cf7-16ad-4c94-aac2-667f3ffa1a14
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_76' UUID cfa2f4fe-c889-4b21-b65c-b36d81cf81ef
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_77' UUID c9eb7070-85ba-478b-bf8e-36fef626a1d2
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_78' UUID 2a0f49e4-79f8-4bf3-bd89-768422096986
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_79' UUID a7da73a2-32ba-4436-b9ce-21d58b13901e
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_80' UUID 00915816-a566-4a9a-9d02-20f4a02d3962
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_81' UUID 45ecd46d-d1d6-43c4-9a20-0088154cc47b
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_82' UUID 6f87ad03-4707-4966-98c1-8f602ab9eb02
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_83' UUID f20e5a96-5816-435d-aed3-5bd2f5f7fb8a
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_84' UUID c87f023b-c2fa-4089-ac8f-a8d1ce8b0b33
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_85' UUID 6e4950c5-a199-4ed7-94a0-c2e0df150713
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_86' UUID 26db1444-4a24-44c9-8ebd-5d4e193aedf1
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_87' UUID ff676a59-fbf0-4c81-a85e-1b19c736cab0
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_88' UUID ce9f6336-1b2f-43d5-ae8c-e2f022b971fd
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_89' UUID 0d2551a5-35d7-4320-add7-c4521f5b715a
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_90' UUID b295a8a7-b978-4991-9603-89a55866bcf7
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_91' UUID 6cd1736e-e708-4b21-be86-e8be62daf990
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_92' UUID 617a86d5-b707-434e-8f7d-d5c047d8cafd
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_93' UUID 1e1eb8ad-1394-4d01-8b57-c4a903c9b9ec
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_94' UUID e59effee-8e43-483e-8636-57a61b7465cc
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_95' UUID b185f617-2612-42c6-8a61-daa1fd762dfe
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_96' UUID e39beb2a-4ec0-4ead-a11b-173a0d9183db
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_97' UUID 14366492-74fd-41dd-8123-4b84810752b1
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_98' UUID ac9a6f3d-48c8-443f-8abe-e66eb31ae310
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_99' UUID 404150fb-823a-4d83-b8d0-a97e7157ec09
2025-06-28 21:11:25.808 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 50 local changes to push.
2025-06-28 21:11:25.808 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 50 changes to http://localhost:50998/sync/send
----------------------------------------

20. 2025-06-28 21:11:25.810 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
=================================== FAILURES ===================================
__________ TestClientSyncEngineIntegration.test_push_pull_basic_flow ___________
Tests/Media_DB/test_sync_client_integration.py:219: in test_push_pull_basic_flow
    entities = create_test_entities(client_db)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Tests/Media_DB/test_sync_client_integration.py:197: in create_test_entities
    media_id = db.insert_media_item(
               ^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'insert_media_item'
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

21. 2025-06-28 21:11:23.690 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpl0iod593.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:23.690 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpl0iod593.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpa6mjw1cl.db
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50990
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:23.690 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'test_keyword' UUID 6fb882e0-f09e-4da3-a36d-da65ca923c69
_________ TestClientSyncEngineIntegration.test_conflict_resolution_lww _________
Tests/Media_DB/test_sync_client_integration.py:276: in test_conflict_resolution_lww
    client2_engine._pull_and_apply_server_changes()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'ClientSyncEngine' object has no attribute '_pull_and_apply_server_changes'. Did you mean: '_pull_and_apply_remote_changes'?
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

22. 2025-06-28 21:11:24.201 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpg4da6we0.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:24.201 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpg4da6we0.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:24.201 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:24.201 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmps26ejjco.db
2025-06-28 21:11:24.201 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50991
2025-06-28 21:11:24.201 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:24.202 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'original' UUID 5bcd8985-8849-460b-bb71-ee1369703547
2025-06-28 21:11:24.202 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:24.202 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:24.202 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:50991/sync/send
----------------------------------------

23. 2025-06-28 21:11:24.206 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
----------------------------------------

24. 2025-06-28 21:11:24.211 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpq2zsjw9v.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:24.211 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpq2zsjw9v.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:24.211 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client2'.
2025-06-28 21:11:24.211 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpdozk_jop.db
2025-06-28 21:11:24.211 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50991
2025-06-28 21:11:24.211 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
___________ TestClientSyncEngineIntegration.test_sync_with_deletions ___________
Tests/Media_DB/test_sync_client_integration.py:309: in test_sync_with_deletions
    entities = create_test_entities(client_db)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Tests/Media_DB/test_sync_client_integration.py:197: in create_test_entities
    media_id = db.insert_media_item(
               ^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'insert_media_item'
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

25. 2025-06-28 21:11:24.718 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpr3wsuqpu.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:24.718 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpr3wsuqpu.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmppzdxvs02.db
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50993
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:24.718 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'test_keyword' UUID b69cfade-2f68-4c20-850f-f199b47673de
_________ TestClientSyncEngineIntegration.test_network_error_handling __________
.venv/lib/python3.12/site-packages/urllib3/util/url.py:434: in parse_url
    raise LocationParseError(url)
E   urllib3.exceptions.LocationParseError: Failed to parse: http://localhost:99999/sync/send
----------------------------------------

26. 2025-06-28 21:11:25.232 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp28z38kyl.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:25.232 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp28z38kyl.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:25.232 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'test_client'.
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpd_wyzbzj.db
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:99999
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'test' UUID 54c4b6f7-cde1-4775-b2f4-01af1ccad744
2025-06-28 21:11:25.233 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.233 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:25.233 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:99999/sync/send
__________ TestClientSyncEngineIntegration.test_idempotent_operations __________
Tests/Media_DB/test_sync_client_integration.py:404: in test_idempotent_operations
    client2_engine._pull_and_apply_server_changes()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'ClientSyncEngine' object has no attribute '_pull_and_apply_server_changes'. Did you mean: '_pull_and_apply_remote_changes'?
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

27. 2025-06-28 21:11:25.274 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpsc1g5pz3.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:25.275 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpsc1g5pz3.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:25.275 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:25.275 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpxzm6w2bv.db
2025-06-28 21:11:25.275 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50994
2025-06-28 21:11:25.275 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:25.276 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'idempotent_test' UUID 21df07f7-8f73-49f4-a576-9d528fd315e0
2025-06-28 21:11:25.276 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.276 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:25.276 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:50994/sync/send
----------------------------------------

28. 2025-06-28 21:11:25.278 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
2025-06-28 21:11:25.278 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.278 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:25.278 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:50994/sync/send
----------------------------------------

29. 2025-06-28 21:11:25.279 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
2025-06-28 21:11:25.279 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.279 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 1 local changes to push.
2025-06-28 21:11:25.279 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 1 changes to http://localhost:50994/sync/send
----------------------------------------

30. 2025-06-28 21:11:25.279 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
----------------------------------------

31. 2025-06-28 21:11:25.285 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpi1j8gjd9.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:25.285 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpi1j8gjd9.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:25.285 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client2'.
2025-06-28 21:11:25.285 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp83njm482.db
2025-06-28 21:11:25.285 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50994
2025-06-28 21:11:25.285 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
_______________ TestSyncEnginePerformance.test_large_batch_sync ________________
Tests/Media_DB/test_sync_client_integration.py:438: in test_large_batch_sync
    assert len(MockSyncServer.server_logs) == num_items
E   assert 0 == 100
E    +  where 0 = len([])
E    +    where [] = MockSyncServer.server_logs
---------------------------- Captured stderr setup -----------------------------
----------------------------------------

32. 2025-06-28 21:11:25.792 | ERROR    | tldw_chatbook.DB.Sync_Client:_load_sync_state:76 - Error loading sync state from /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpdn_pcmjm.json: Expecting value: line 1 column 1 (char 0). Starting from scratch.
2025-06-28 21:11:25.792 | DEBUG    | tldw_chatbook.DB.Sync_Client:_save_sync_state:94 - Saved sync state to /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpdn_pcmjm.json: {'last_local_log_id_sent': 0, 'last_server_log_id_processed': 0}
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:55 - ClientSyncEngine initialized for client 'client_test_integration'.
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:56 -   DB Path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpmowd13vf.db
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:57 -   Server URL: http://localhost:50998
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Sync_Client:__init__:58 -   Initial State: Last Sent=0, Last Processed=0
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_0' UUID b5f2901a-49c5-43ef-8f7e-f0b8635f6467
2025-06-28 21:11:25.792 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_1' UUID 7c2263e4-d51c-479e-8368-ec38eb9eaa73
2025-06-28 21:11:25.793 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_2' UUID a9df149c-3af2-4653-8327-273eb1471256
2025-06-28 21:11:25.793 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_3' UUID fb06bb80-3d9b-416e-9181-25197ad1dc90
2025-06-28 21:11:25.793 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_4' UUID 6ac893ac-d96b-4dec-923b-921d66cb23d4
2025-06-28 21:11:25.793 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_5' UUID af9bf03f-ae16-4004-a971-30993bd488c2
2025-06-28 21:11:25.794 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_6' UUID 1fb00484-11cd-411d-8d76-9593d73b4e45
2025-06-28 21:11:25.794 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_7' UUID 439b628a-5012-4f49-baf0-3787b2116139
2025-06-28 21:11:25.794 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_8' UUID 42e53d4a-20e0-4ce9-af52-3ac3b25a33ec
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_9' UUID d87f99f4-caa9-49dd-b58a-7620716ab90f
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_10' UUID 86e99db4-cc20-4477-8de9-605617c98919
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_11' UUID 2e72aac9-0f17-40ee-9357-fa78995a2b04
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_12' UUID 70a49383-aae5-4598-ad33-b8f83e96468e
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_13' UUID 708eab19-2f3b-4544-89ee-d74e926514ac
2025-06-28 21:11:25.795 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_14' UUID da1c0beb-36ab-489c-8349-9cda94f4fc10
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_15' UUID fd135c70-bc3c-4272-a6e3-b0b34065b3f5
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_16' UUID 90d9b49f-2e46-4abe-8760-12cd87075308
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_17' UUID 58b958b9-a8c8-43ad-a608-f90993a9b801
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_18' UUID 21433876-1025-4bc6-9efb-7cbbe208b15d
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_19' UUID c4b81c19-0a48-4ea2-a65e-a505653f614d
2025-06-28 21:11:25.796 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_20' UUID 894276b3-df49-4d9e-a56a-29c24f4b6ded
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_21' UUID e3dcd0a1-33a6-4467-b552-54e52b62b7af
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_22' UUID fec51ca4-c0e0-40c2-b54f-42efce4717a4
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_23' UUID 6a02b983-2294-43ed-bfa1-6f61579c84b5
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_24' UUID b6e3e719-0ddf-412d-a0b8-3fa750be7e72
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_25' UUID 52be4128-6d8b-47ce-9f9e-6647e2e5078f
2025-06-28 21:11:25.797 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_26' UUID 54c26b0f-9288-4fe0-857b-16ff9df4cd69
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_27' UUID b0aa5f13-1ae3-4971-b53c-21b967410b68
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_28' UUID 967e0964-861b-41e3-a866-19451eccf124
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_29' UUID c7d04a77-923f-4b8e-8cd5-65c8e2499c1e
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_30' UUID 0e694aad-325f-4577-b1b2-2646b40e47b8
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_31' UUID 73b7dbba-c573-43cb-9012-d3141e68c1d9
2025-06-28 21:11:25.798 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_32' UUID e62cebf1-ea76-4a9a-a601-2873c8076110
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_33' UUID 7e1b6d7c-e0c7-4a0a-aef2-9cabe822f7d5
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_34' UUID b9a535bc-cf45-465e-a84b-637a90db7c1a
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_35' UUID cd9c3402-a606-48a7-be6a-cdc81858ec81
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_36' UUID c2747111-3b1d-4a23-afd0-c65ebd2faf56
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_37' UUID c3dfbb8f-629b-459d-b729-306ab10bff2e
2025-06-28 21:11:25.799 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_38' UUID 206cbf5f-96ad-4d5f-9c01-2340c03d7cff
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_39' UUID 6d0380a2-eb27-41de-a05c-580d3b556e3a
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_40' UUID 0833b42d-5450-4ec5-8715-9c8b47232ae9
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_41' UUID 4f1e7513-2ebe-4dc0-8ee6-ce293d3bdeb1
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_42' UUID ab5a4f22-e1c6-4508-ba41-dd0dd85df6e4
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_43' UUID d9fb5cc6-4ac1-4483-8ce2-8cae885a02bf
2025-06-28 21:11:25.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_44' UUID d159ec82-8907-40bc-a9e7-d5b41b6a7b0f
2025-06-28 21:11:25.801 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_45' UUID 0f0ac445-331d-4d17-b605-d7a840daa0e9
2025-06-28 21:11:25.801 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_46' UUID 9ec0ea07-e4ef-4bd5-bb3b-82ba8934b0cc
2025-06-28 21:11:25.801 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_47' UUID 175f7ece-0778-4c39-994c-b33475fd3da1
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_48' UUID ecd9a087-4034-4d49-bef2-b0a2fd68a501
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_49' UUID 9fc951db-f11c-43df-9691-f53147272631
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_50' UUID 5505c6c1-61ff-441f-9e4a-0ebfdb98908c
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_51' UUID 96daecc5-06ea-456c-b3cc-69a674423c76
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_52' UUID 22485574-86ec-4c52-90f5-9086eb80f7df
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_53' UUID b5bd2350-bb5c-4bb9-aa90-4827a11e1783
2025-06-28 21:11:25.802 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_54' UUID 4a0955d7-acda-4a3e-85c8-783fdbd6146f
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_55' UUID 3264d2ed-249b-4789-ac19-281482582a7a
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_56' UUID d63bd2ee-2931-41e3-8baf-6c83af5a330a
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_57' UUID f69181d5-1a4e-4880-bf29-48dd05072199
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_58' UUID 4824c7b8-59d0-43d1-8a16-657d64d1e4f3
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_59' UUID 2482f49d-9ca9-42fb-bb75-c138780838b1
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_60' UUID fdbe70ad-0260-4e07-89c2-971ad8098a2c
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_61' UUID bcccd698-ba12-4002-b5fe-7df7d2f49c2e
2025-06-28 21:11:25.803 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_62' UUID ad1d8e3f-4042-4bdc-8246-147f7aabec22
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_63' UUID de5f5a04-9a44-44fc-bf79-c580ca55f5fd
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_64' UUID 35dafe7e-ebeb-4c81-81d1-b183b5212a80
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_65' UUID f8b5a791-4ad5-4ee4-9cee-0b28947478ed
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_66' UUID 62e4a2a4-73d2-4521-a724-68d9baabce32
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_67' UUID 365333ed-ed61-4d60-9abf-f5b80b2f6a65
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_68' UUID 2aa2fcf7-d32a-4077-8d19-fd44de1bf6a3
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_69' UUID a0d78c01-d69f-49a0-946e-1b07dc8c3d5a
2025-06-28 21:11:25.804 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_70' UUID 2a11cede-10a3-4b19-bb0f-9516e2ced0af
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_71' UUID 5a3db7ab-9982-407d-9add-e25c04591171
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_72' UUID cd005106-d452-4390-96d5-ff74100a4a39
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_73' UUID 7fa3beb0-5fce-4327-a717-cc9e5cce7e3c
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_74' UUID c54e1e2e-cc31-4bb2-a943-6074c83b21bd
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_75' UUID a4929cf7-16ad-4c94-aac2-667f3ffa1a14
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_76' UUID cfa2f4fe-c889-4b21-b65c-b36d81cf81ef
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_77' UUID c9eb7070-85ba-478b-bf8e-36fef626a1d2
2025-06-28 21:11:25.805 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_78' UUID 2a0f49e4-79f8-4bf3-bd89-768422096986
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_79' UUID a7da73a2-32ba-4436-b9ce-21d58b13901e
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_80' UUID 00915816-a566-4a9a-9d02-20f4a02d3962
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_81' UUID 45ecd46d-d1d6-43c4-9a20-0088154cc47b
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_82' UUID 6f87ad03-4707-4966-98c1-8f602ab9eb02
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_83' UUID f20e5a96-5816-435d-aed3-5bd2f5f7fb8a
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_84' UUID c87f023b-c2fa-4089-ac8f-a8d1ce8b0b33
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_85' UUID 6e4950c5-a199-4ed7-94a0-c2e0df150713
2025-06-28 21:11:25.806 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_86' UUID 26db1444-4a24-44c9-8ebd-5d4e193aedf1
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_87' UUID ff676a59-fbf0-4c81-a85e-1b19c736cab0
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_88' UUID ce9f6336-1b2f-43d5-ae8c-e2f022b971fd
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_89' UUID 0d2551a5-35d7-4320-add7-c4521f5b715a
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_90' UUID b295a8a7-b978-4991-9603-89a55866bcf7
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_91' UUID 6cd1736e-e708-4b21-be86-e8be62daf990
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_92' UUID 617a86d5-b707-434e-8f7d-d5c047d8cafd
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_93' UUID 1e1eb8ad-1394-4d01-8b57-c4a903c9b9ec
2025-06-28 21:11:25.807 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_94' UUID e59effee-8e43-483e-8636-57a61b7465cc
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_95' UUID b185f617-2612-42c6-8a61-daa1fd762dfe
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_96' UUID e39beb2a-4ec0-4ead-a11b-173a0d9183db
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_97' UUID 14366492-74fd-41dd-8123-4b84810752b1
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_98' UUID ac9a6f3d-48c8-443f-8abe-e66eb31ae310
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:add_keyword:1469 - Adding new keyword 'keyword_99' UUID 404150fb-823a-4d83-b8d0-a97e7157ec09
2025-06-28 21:11:25.808 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:131 - Checking for local changes since log ID 0
2025-06-28 21:11:25.808 | INFO     | tldw_chatbook.DB.Sync_Client:_push_local_changes:145 - Found 50 local changes to push.
2025-06-28 21:11:25.808 | DEBUG    | tldw_chatbook.DB.Sync_Client:_push_local_changes:159 - Posting 50 changes to http://localhost:50998/sync/send
----------------------------------------

33. 2025-06-28 21:11:25.810 | ERROR    | tldw_chatbook.DB.Sync_Client:_push_local_changes:179 - HTTP error pushing changes: Unknown - No response body
=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/_hypothesis_pytestplugin.py:461
  /Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/_hypothesis_pytestplugin.py:461: UserWarning: Skipping collection of '.hypothesis' directory - this usually means you've explicitly set the `norecursedirs` pytest config option, replacing rather than extending the default ignores.
    warnings.warn(
----------------------------------------

34. ERROR Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_push_pull_basic_flow
----------------------------------------

35. ERROR Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_conflict_resolution_lww
----------------------------------------

36. ERROR Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_sync_with_deletions
----------------------------------------

37. ERROR Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_network_error_handling
----------------------------------------

38. ERROR Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_idempotent_operations
----------------------------------------

39. ERROR Tests/Media_DB/test_sync_client_integration.py::TestSyncEnginePerformance::test_large_batch_sync
----------------------------------------

40. FAILED Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_push_pull_basic_flow
----------------------------------------

41. FAILED Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_conflict_resolution_lww
----------------------------------------

42. FAILED Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_sync_with_deletions
----------------------------------------

43. FAILED Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_network_error_handling
----------------------------------------

44. FAILED Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_idempotent_operations
----------------------------------------

45. FAILED Tests/Media_DB/test_sync_client_integration.py::TestSyncEnginePerformance::test_large_batch_sync
6 failed, 46 passed, 1 warning, 6 errors in 4.79s
----------------------------------------

46. Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_push_pull_basic_flow: Tests/Media_DB/test_sync_client_integration.py:219: in test_push_pull_basic_flow
    entities = create_test_entities(client_db)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Tests/Media_DB/test_sync_client_integration.py:197: in create_test_entities
    media_id = db.insert_media_item(
               ^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'insert_media_item'
----------------------------------------

47. Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_conflict_resolution_lww: Tests/Media_DB/test_sync_client_integration.py:276: in test_conflict_resolution_lww
    client2_engine._pull_and_apply_server_changes()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'ClientSyncEngine' object has no attribute '_pull_and_apply_server_changes'. Did you mean: '_pull_and_apply_remote_changes'?
----------------------------------------

48. Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_sync_with_deletions: Tests/Media_DB/test_sync_client_integration.py:309: in test_sync_with_deletions
    entities = create_test_entities(client_db)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Tests/Media_DB/test_sync_client_integration.py:197: in create_test_entities
    media_id = db.insert_media_item(
               ^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'MediaDatabase' object has no attribute 'insert_media_item'
----------------------------------------

49. Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_network_error_handling: .venv/lib/python3.12/site-packages/urllib3/util/url.py:434: in parse_url
    raise LocationParseError(url)
E   urllib3.exceptions.LocationParseError: Failed to parse: http://localhost:99999/sync/send

The above exception was the direct cause of the following exception:
.venv/lib/python3.12/site-packages/requests/models.py:433: in prepare_url
    scheme, auth, host, port, path, query, fragment = parse_url(url)
                                                      ^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/urllib3/util/url.py:449: in parse_url
    raise LocationParseError(source_url) from e
E   urllib3.exceptions.LocationParseError: Failed to parse: http://localhost:99999/sync/send

During handling of the above exception, another exception occurred:
Tests/Media_DB/test_sync_client_integration.py:361: in test_network_error_handling
    engine._push_local_changes()
tldw_chatbook/DB/Sync_Client.py:166: in _push_local_changes
    response = requests.post(full_url, json=payload, headers=headers, timeout=45)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/api.py:115: in post
    return request("post", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/api.py:59: in request
    return session.request(method=method, url=url, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/sessions.py:575: in request
    prep = self.prepare_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/sessions.py:484: in prepare_request
    p.prepare(
.venv/lib/python3.12/site-packages/requests/models.py:367: in prepare
    self.prepare_url(url, params)
.venv/lib/python3.12/site-packages/requests/models.py:435: in prepare_url
    raise InvalidURL(*e.args)
E   requests.exceptions.InvalidURL: Failed to parse: http://localhost:99999/sync/send
----------------------------------------

50. Tests/Media_DB/test_sync_client_integration.py::TestClientSyncEngineIntegration::test_idempotent_operations: Tests/Media_DB/test_sync_client_integration.py:404: in test_idempotent_operations
    client2_engine._pull_and_apply_server_changes()
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'ClientSyncEngine' object has no attribute '_pull_and_apply_server_changes'. Did you mean: '_pull_and_apply_remote_changes'?
----------------------------------------

51. Tests/Media_DB/test_sync_client_integration.py::TestSyncEnginePerformance::test_large_batch_sync: Tests/Media_DB/test_sync_client_integration.py:438: in test_large_batch_sync
    assert len(MockSyncServer.server_logs) == num_items
E   assert 0 == 100
E    +  where 0 = len([])
E    +    where [] = MockSyncServer.server_logs
----------------------------------------

================================================================================

Directory: Prompts_DB
Duration: 0.61s
Passed: 19, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: Character_Chat
Duration: 0.52s
Passed: 14, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: Chat
Duration: 6.19s
Passed: 58, Failed: 7, Skipped: 39, Errors: 9

Failures:

1. ==================================== ERRORS ====================================
----------------------------------------

2. ______________ ERROR at setup of test_media_search_initial_state _______________
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,718 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

3. 2025-06-28 21:11:33,719 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

4. 2025-06-28 21:11:33,719 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

5. 2025-06-28 21:11:33,719 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.719 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.719 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.719 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.719 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.719 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.721 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.721 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.722 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.722 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.722 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,722 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,722 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.722 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

6. 2025-06-28 21:11:33,722 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

7. 2025-06-28 21:11:33,722 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,722 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.722 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.722 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.722 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.722 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.722 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.723 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.724 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,724 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,724 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.724 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.724 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.725 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.725 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.725 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.725 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.725 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.725 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,725 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,725 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,725 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,725 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,725 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,725 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,725 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.725 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.725 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x1671e0740>
2025-06-28 21:11:33.725 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.725 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,725 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.725 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.725 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

8. 2025-06-28 21:11:33,725 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

9. 2025-06-28 21:11:33,725 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.725 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.726 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,726 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,726 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

10. 2025-06-28 21:11:33,726 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.007 seconds
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (32.9%)
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.3%)
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.8%)
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (35.9%)
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (6.6%)
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.001s (7.6%)
2025-06-28 21:11:33.726 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

11. 2025-06-28 21:11:33,726 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

12. 2025-06-28 21:11:33,726 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

13. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

14. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

15. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

16. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

17. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

18. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

19. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

20. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

21. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

22. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

23. ______________ ERROR at setup of test_media_search_functionality _______________
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,729 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

24. 2025-06-28 21:11:33,730 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

25. 2025-06-28 21:11:33,730 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

26. 2025-06-28 21:11:33,730 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.730 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.730 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.730 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.730 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.730 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.731 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.732 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.732 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.732 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.732 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,732 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,732 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.732 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

27. 2025-06-28 21:11:33,732 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

28. 2025-06-28 21:11:33,732 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,732 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.732 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.732 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.732 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.733 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.733 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.734 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.735 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,735 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,735 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.735 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:11:33.735 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.735 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.735 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.735 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.735 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.735 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.735 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.735 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,735 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,735 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,735 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,736 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,736 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,736 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,736 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.736 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x1671e8650>
2025-06-28 21:11:33.736 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.736 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,736 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

29. 2025-06-28 21:11:33,736 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

30. 2025-06-28 21:11:33,736 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.736 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.736 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,736 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,736 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

31. 2025-06-28 21:11:33,736 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (34.7%)
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.7%)
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (36.5%)
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (6.8%)
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.001s (8.6%)
2025-06-28 21:11:33.736 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

32. 2025-06-28 21:11:33,736 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

33. 2025-06-28 21:11:33,736 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

34. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

35. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

36. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

37. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

38. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

39. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

40. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

41. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

42. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

43. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

44. _________________ ERROR at setup of test_media_load_for_review _________________
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,740 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

45. 2025-06-28 21:11:33,740 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

46. 2025-06-28 21:11:33,740 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

47. 2025-06-28 21:11:33,740 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.740 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.740 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.741 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.741 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.741 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.742 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,743 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,743 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

48. 2025-06-28 21:11:33,743 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

49. 2025-06-28 21:11:33,743 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,743 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.743 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.743 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.744 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.745 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,745 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,745 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.745 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:11:33.745 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.745 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,746 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,746 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,746 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,746 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,746 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,746 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,746 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x16718ca40>
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,746 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

50. 2025-06-28 21:11:33,746 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

51. 2025-06-28 21:11:33,746 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.746 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,746 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,746 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

52. 2025-06-28 21:11:33,746 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (37.6%)
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.9%)
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (36.0%)
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.7%)
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.5%)
2025-06-28 21:11:33.746 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

53. 2025-06-28 21:11:33,746 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

54. 2025-06-28 21:11:33,746 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

55. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

56. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

57. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

58. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

59. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

60. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

61. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

62. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

63. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

64. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

65. _ ERROR at setup of test_media_copy_buttons[chat-media-copy-title-button-title-Title copied to clipboard.] _
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,750 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

66. 2025-06-28 21:11:33,750 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

67. 2025-06-28 21:11:33,750 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

68. 2025-06-28 21:11:33,750 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.750 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.750 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.750 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.750 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.750 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.752 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.752 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.752 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.753 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.753 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,753 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,753 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.753 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

69. 2025-06-28 21:11:33,753 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

70. 2025-06-28 21:11:33,753 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,753 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.753 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.753 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.753 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.753 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.753 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.754 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.755 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,755 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,755 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.755 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:11:33.755 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.755 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.755 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.755 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.755 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.755 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.755 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.755 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,755 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,755 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,756 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,756 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,756 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,756 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,756 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.756 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x166af66f0>
2025-06-28 21:11:33.756 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.756 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,756 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

71. 2025-06-28 21:11:33,756 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

72. 2025-06-28 21:11:33,756 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.756 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.756 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,756 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,756 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

73. 2025-06-28 21:11:33,756 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (34.2%)
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.7%)
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (35.7%)
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (6.1%)
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.001s (11.7%)
2025-06-28 21:11:33.756 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

74. 2025-06-28 21:11:33,756 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

75. 2025-06-28 21:11:33,757 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

76. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

77. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

78. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

79. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

80. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

81. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

82. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

83. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

84. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

85. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

86. _ ERROR at setup of test_media_copy_buttons[chat-media-copy-content-button-content-Content copied to clipboard.] _
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,761 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

87. 2025-06-28 21:11:33,761 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

88. 2025-06-28 21:11:33,761 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

89. 2025-06-28 21:11:33,761 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.761 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.761 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.761 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.761 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.761 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.763 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.763 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.764 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.764 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.764 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,764 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,764 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.764 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

90. 2025-06-28 21:11:33,764 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

91. 2025-06-28 21:11:33,764 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,764 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.764 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.764 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.764 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.764 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.764 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.765 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.766 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,766 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,766 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.766 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:11:33.766 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.766 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.766 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.766 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.766 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.766 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.766 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.766 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,766 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,766 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,767 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,767 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,767 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,767 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,767 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.767 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x1671ce330>
2025-06-28 21:11:33.767 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.767 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,767 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

92. 2025-06-28 21:11:33,767 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

93. 2025-06-28 21:11:33,767 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.767 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.767 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,767 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,767 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

94. 2025-06-28 21:11:33,767 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.7%)
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.8%)
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (36.6%)
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (6.2%)
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (8.1%)
2025-06-28 21:11:33.767 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

95. 2025-06-28 21:11:33,767 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

96. 2025-06-28 21:11:33,767 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

97. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

98. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

99. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

100. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

101. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

102. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

103. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

104. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

105. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

106. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

107. _ ERROR at setup of test_media_copy_buttons[chat-media-copy-author-button-author-Author copied to clipboard.] _
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,771 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

108. 2025-06-28 21:11:33,771 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

109. 2025-06-28 21:11:33,771 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

110. 2025-06-28 21:11:33,771 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.772 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.772 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.772 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.772 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.772 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.773 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,774 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,774 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

111. 2025-06-28 21:11:33,774 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

112. 2025-06-28 21:11:33,774 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,774 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.774 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.774 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.776 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.776 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,776 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,776 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.776 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:11:33.776 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.776 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,777 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,777 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,777 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,777 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,777 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,777 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,777 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x167b178c0>
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,777 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

113. 2025-06-28 21:11:33,777 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

114. 2025-06-28 21:11:33,777 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.777 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,777 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,777 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

115. 2025-06-28 21:11:33,777 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.7%)
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.7%)
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (35.8%)
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.7%)
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.5%)
2025-06-28 21:11:33.777 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

116. 2025-06-28 21:11:33,777 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

117. 2025-06-28 21:11:33,778 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

118. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

119. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

120. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

121. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

122. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

123. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

124. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

125. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

126. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

127. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

128. _ ERROR at setup of test_media_copy_buttons[chat-media-copy-url-button-url-URL copied to clipboard.] _
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,782 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

129. 2025-06-28 21:11:33,783 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

130. 2025-06-28 21:11:33,783 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

131. 2025-06-28 21:11:33,783 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.783 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.783 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.783 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.783 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.783 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.784 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.785 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.785 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.785 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.785 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,785 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,785 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.785 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

132. 2025-06-28 21:11:33,785 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

133. 2025-06-28 21:11:33,786 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,786 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.786 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.786 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.786 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.786 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.786 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.787 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.788 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,788 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,788 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.788 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:11:33.788 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.788 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.788 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.789 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.789 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.789 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.789 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.789 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,789 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,789 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,790 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,790 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,790 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,790 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,790 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.790 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.790 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x16483f140>
2025-06-28 21:11:33.790 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.790 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,790 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.790 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.790 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

134. 2025-06-28 21:11:33,790 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

135. 2025-06-28 21:11:33,790 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.790 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.790 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,790 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,790 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

136. 2025-06-28 21:11:33,790 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.008 seconds
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (28.0%)
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.1%)
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (31.5%)
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.001s (10.8%)
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.001s (15.7%)
2025-06-28 21:11:33.791 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

137. 2025-06-28 21:11:33,791 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

138. 2025-06-28 21:11:33,791 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

139. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

140. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

141. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

142. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

143. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

144. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

145. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

146. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

147. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

148. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

149. _______ ERROR at setup of test_media_review_clearing_on_new_empty_search _______
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,794 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

150. 2025-06-28 21:11:33,794 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

151. 2025-06-28 21:11:33,794 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

152. 2025-06-28 21:11:33,794 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.795 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.795 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.795 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.795 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.795 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.796 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,797 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,797 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

153. 2025-06-28 21:11:33,797 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

154. 2025-06-28 21:11:33,797 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,797 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.797 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.797 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.799 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.799 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,799 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,799 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.800 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,800 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,800 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,800 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,800 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,800 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,800 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,800 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x16718db50>
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,800 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

155. 2025-06-28 21:11:33,800 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

156. 2025-06-28 21:11:33,800 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.800 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,800 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,800 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

157. 2025-06-28 21:11:33,800 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (36.4%)
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.7%)
2025-06-28 21:11:33.800 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (37.1%)
2025-06-28 21:11:33.801 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.7%)
2025-06-28 21:11:33.801 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.5%)
2025-06-28 21:11:33.801 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

158. 2025-06-28 21:11:33,801 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

159. 2025-06-28 21:11:33,801 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

160. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

161. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

162. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

163. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

164. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

165. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

166. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

167. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

168. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

169. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

170. _____________ ERROR at setup of test_media_search_input_debounced ______________
Tests/Chat/test_chat_sidebar_media_search.py:63: in real_app_media_test
    app.media_db = MediaDatabase(str(media_db_path))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:11:33,804 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

171. 2025-06-28 21:11:33,804 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

172. 2025-06-28 21:11:33,804 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

173. 2025-06-28 21:11:33,804 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:11:33.804 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.804 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.804 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.804 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.804 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.805 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.806 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33.806 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.806 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.807 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,807 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:11:33,807 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:33.807 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

174. 2025-06-28 21:11:33,807 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

175. 2025-06-28 21:11:33,807 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33,807 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:11:33.807 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.807 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.807 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.807 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.807 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.808 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.809 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,809 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:33,809 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:11:33.809 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:11:33.809 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:11:33.809 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:11:33.809 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:11:33.809 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:33.809 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:33.809 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:33.809 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33.809 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:11:33,809 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:33,810 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:33,810 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:33,810 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:11:33,810 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:11:33,810 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:11:33,810 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.810 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x1671e9e50>
2025-06-28 21:11:33.810 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:33.810 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:11:33,810 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

176. 2025-06-28 21:11:33,810 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

177. 2025-06-28 21:11:33,810 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:11:33.810 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:11:33.810 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:11:33,810 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:11:33,810 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

178. 2025-06-28 21:11:33,810 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.3%)
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.3%)
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.8%)
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (38.8%)
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.7%)
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.5%)
2025-06-28 21:11:33.810 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

179. 2025-06-28 21:11:33,810 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

180. 2025-06-28 21:11:33,810 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

181. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

182. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

183. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

184. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

185. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

186. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

187. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

188. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

189. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

190. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
=================================== FAILURES ===================================
___________________ test_provider_api_basic_call[koboldcpp] ____________________
.venv/lib/python3.12/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.12/site-packages/urllib3/util/connection.py:85: in create_connection
    raise err
.venv/lib/python3.12/site-packages/urllib3/util/connection.py:73: in create_connection
    sock.connect(sa)
E   ConnectionRefusedError: [Errno 61] Connection refused
----------------------------------------

191. 2025-06-28 21:11:32,729 [ERROR] root:566 - KoboldAI (Native): Request Exception: HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x16491b290>: Failed to establish a new connection: [Errno 61] Connection refused'))
Traceback (most recent call last):
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused
----------------------------------------

192. 2025-06-28 21:11:32.733 | ERROR    | tldw_chatbook.Chat.Chat_Functions:chat_api_call:683 - Handler for koboldcpp directly raised: ChatProviderError - Network error calling KoboldAI (Native): HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x16491b290>: Failed to establish a new connection: [Errno 61] Connection refused'))
------------------------------ Captured log call -------------------------------
DEBUG    root:LLM_API_Calls_Local.py:440 KoboldAI (Native): Chat request starting...
INFO     root:LLM_API_Calls_Local.py:461 Kobold API model namenot passed and or could not be determined from arguments or configuration.
DEBUG    root:LLM_API_Calls_Local.py:535 KoboldAI (Native): Posting to http://localhost:5001/api/v1/generate. Prompt (first 200 chars): 'Hello! Respond with just 'Hello'....'
DEBUG    root:LLM_API_Calls_Local.py:536 KoboldAI (Native) Payload details: {'prompt': "Hello! Respond with just 'Hello'.", 'max_context_length': 2048, 'temperature': 0.7, 'top_p': 0.9, 'top_k': 50, 'seed': 42}
DEBUG    urllib3.connectionpool:connectionpool.py:241 Starting new HTTP connection (1): localhost:5001
DEBUG    urllib3.util.retry:retry.py:521 Incremented Retry for (url='/api/v1/generate'): Retry(total=0, connect=None, read=None, redirect=None, status=None)
WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x16491bfe0>: Failed to establish a new connection: [Errno 61] Connection refused')': /api/v1/generate
DEBUG    urllib3.connectionpool:connectionpool.py:241 Starting new HTTP connection (2): localhost:5001
----------------------------------------

193. ERROR    root:LLM_API_Calls_Local.py:566 KoboldAI (Native): Request Exception: HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x16491b290>: Failed to establish a new connection: [Errno 61] Connection refused'))
Traceback (most recent call last):
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused
----------------------------------------

194. 2025-06-28 21:11:32,847 [ERROR] root:566 - KoboldAI (Native): Request Exception: HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x166a08c50>: Failed to establish a new connection: [Errno 61] Connection refused'))
Traceback (most recent call last):
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused
----------------------------------------

195. 2025-06-28 21:11:32.848 | ERROR    | tldw_chatbook.Chat.Chat_Functions:chat_api_call:683 - Handler for koboldcpp directly raised: ChatProviderError - Network error calling KoboldAI (Native): HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x166a08c50>: Failed to establish a new connection: [Errno 61] Connection refused'))
------------------------------ Captured log call -------------------------------
DEBUG    root:LLM_API_Calls_Local.py:440 KoboldAI (Native): Chat request starting...
INFO     root:LLM_API_Calls_Local.py:461 Kobold API model namenot passed and or could not be determined from arguments or configuration.
WARNING  root:LLM_API_Calls_Local.py:477 KoboldAI (Native): Streaming with /api/v1/generate is often non-standard. Consider using KoboldCpp's OpenAI compatible endpoint (/v1) for reliable streaming. Forcing non-streaming for native.
DEBUG    root:LLM_API_Calls_Local.py:535 KoboldAI (Native): Posting to http://localhost:5001/api/v1/generate. Prompt (first 200 chars): 'Stream three words....'
DEBUG    root:LLM_API_Calls_Local.py:536 KoboldAI (Native) Payload details: {'prompt': 'Stream three words.', 'max_context_length': 2048, 'temperature': 0.7, 'top_p': 0.9, 'top_k': 50, 'seed': 43}
DEBUG    urllib3.connectionpool:connectionpool.py:241 Starting new HTTP connection (1): localhost:5001
DEBUG    urllib3.util.retry:retry.py:521 Incremented Retry for (url='/api/v1/generate'): Retry(total=0, connect=None, read=None, redirect=None, status=None)
WARNING  urllib3.connectionpool:connectionpool.py:868 Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x1649a7a40>: Failed to establish a new connection: [Errno 61] Connection refused')': /api/v1/generate
DEBUG    urllib3.connectionpool:connectionpool.py:241 Starting new HTTP connection (2): localhost:5001
----------------------------------------

196. ERROR    root:LLM_API_Calls_Local.py:566 KoboldAI (Native): Request Exception: HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x166a08c50>: Failed to establish a new connection: [Errno 61] Connection refused'))
Traceback (most recent call last):
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 61] Connection refused
----------------------------------------

197.     __self._log("ERROR", False, __self._options, __message, args, kwargs)
.venv/lib/python3.12/site-packages/loguru/_logger.py:2055: in _log
    log_record["message"] = message.format(*args, **kwargs)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: '"type"'
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:11:32.946 | INFO     | tldw_chatbook.Chat.Chat_Functions:chat_api_call:577 - Chat API Call - Routing to endpoint: anthropic
2025-06-28 21:11:32.946 | METRIC   | tldw_chatbook.Metrics.metrics_logger:_log_metric:47 - Counter 'chat_api_call_attempt': 1
2025-06-28 21:11:32.946 | DEBUG    | tldw_chatbook.Chat.Chat_Functions:chat_api_call:630 - Calling handler chat_with_anthropic with kwargs: {'api_key': 'key_hidden', 'input_data': <class 'list'>, 'model': <class 'str'>}
2025-06-28 21:11:32.946 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:32.946 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:32.946 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:32.946 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:32.946 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:32.947 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:32.948 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:32,948 [DEBUG] root:391 - Anthropic: Using API Key: Key Provided
2025-06-28 21:11:32,948 [WARNING] root:411 - Anthropic: Skipping message with unsupported role: system
2025-06-28 21:11:32,948 [DEBUG] root:458 - Anthropic Request Payload (excluding messages): {k: v for k, v in data.items() if k != 'messages'}
2025-06-28 21:11:32,949 [DEBUG] urllib3.connectionpool:1049 - Starting new HTTPS connection (1): api.anthropic.com:443
2025-06-28 21:11:33,172 [DEBUG] urllib3.connectionpool:544 - https://api.anthropic.com:443 "POST /v1/messages HTTP/1.1" 401 86
------------------------------ Captured log call -------------------------------
DEBUG    root:LLM_API_Calls.py:391 Anthropic: Using API Key: Key Provided
WARNING  root:LLM_API_Calls.py:411 Anthropic: Skipping message with unsupported role: system
DEBUG    root:LLM_API_Calls.py:458 Anthropic Request Payload (excluding messages): {k: v for k, v in data.items() if k != 'messages'}
DEBUG    urllib3.connectionpool:connectionpool.py:1049 Starting new HTTPS connection (1): api.anthropic.com:443
DEBUG    urllib3.connectionpool:connectionpool.py:544 https://api.anthropic.com:443 "POST /v1/messages HTTP/1.1" 401 86
__________________ TestMockedChatAPIs.test_api_error_handling __________________
tldw_chatbook/Chat/Chat_Functions.py:631: in chat_api_call
    response = handler(**call_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/LLM_Calls/LLM_API_Calls.py:335: in chat_with_openai
    response.raise_for_status()  # Raise HTTPError for 4xx/5xx AFTER retries
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/models.py:1024: in raise_for_status
    raise HTTPError(http_error_msg, response=self)
E   requests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: https://api.openai.com/v1/chat/completions
----------------------------------------

198. 2025-06-28 21:11:33,405 [ERROR] root:344 - OpenAI Full Error Response (status 401): {
    "error": {
        "message": "Incorrect API key provided: invalid-key. You can find your API key at https://platform.openai.com/account/api-keys.",
        "type": "invalid_request_error",
        "param": null,
        "code": "invalid_api_key"
    }
}
----------------------------------------

199. 2025-06-28 21:11:33.405 | ERROR    | tldw_chatbook.Chat.Chat_Functions:chat_api_call:653 - %s. Details: %s
2025-06-28 21:11:33.405 | INFO     | tldw_chatbook.Chat.Chat_Functions:chat_api_call:577 - Chat API Call - Routing to endpoint: openai
2025-06-28 21:11:33.405 | METRIC   | tldw_chatbook.Metrics.metrics_logger:_log_metric:47 - Counter 'chat_api_call_attempt': 1
2025-06-28 21:11:33.405 | DEBUG    | tldw_chatbook.Chat.Chat_Functions:chat_api_call:630 - Calling handler chat_with_openai with kwargs: {'api_key': 'key_hidden', 'input_data': <class 'list'>}
2025-06-28 21:11:33.405 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.405 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:33.405 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:33.405 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:33.405 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.406 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:33.407 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:33,407 [DEBUG] root:207 - OpenAI: Using API Key: Key Provided
2025-06-28 21:11:33,407 [DEBUG] root:280 - OpenAI Request Payload (excluding messages): {k: v for k, v in payload.items() if k != 'messages'}
2025-06-28 21:11:33,407 [DEBUG] root:317 - OpenAI: Posting request (non-streaming)
2025-06-28 21:11:33,408 [DEBUG] urllib3.connectionpool:1049 - Starting new HTTPS connection (1): api.openai.com:443
2025-06-28 21:11:33,541 [DEBUG] urllib3.connectionpool:544 - https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 401 258
2025-06-28 21:11:33,542 [DEBUG] root:334 - OpenAI: Full API response status: 401
----------------------------------------

200. 2025-06-28 21:11:33,542 [ERROR] root:344 - OpenAI Full Error Response (status 401): {
    "error": {
        "message": "Incorrect API key provided: test-key. You can find your API key at https://platform.openai.com/account/api-keys.",
        "type": "invalid_request_error",
        "param": null,
        "code": "invalid_api_key"
    }
}
----------------------------------------

201. 2025-06-28 21:11:33.542 | ERROR    | tldw_chatbook.Chat.Chat_Functions:chat_api_call:653 - %s. Details: %s
------------------------------ Captured log call -------------------------------
DEBUG    root:LLM_API_Calls.py:207 OpenAI: Using API Key: inval...d-key
DEBUG    root:LLM_API_Calls.py:280 OpenAI Request Payload (excluding messages): {k: v for k, v in payload.items() if k != 'messages'}
DEBUG    root:LLM_API_Calls.py:317 OpenAI: Posting request (non-streaming)
DEBUG    urllib3.connectionpool:connectionpool.py:1049 Starting new HTTPS connection (1): api.openai.com:443
DEBUG    urllib3.connectionpool:connectionpool.py:544 https://api.openai.com:443 "POST /v1/chat/completions HTTP/1.1" 401 261
DEBUG    root:LLM_API_Calls.py:334 OpenAI: Full API response status: 401
----------------------------------------

202. ERROR    root:LLM_API_Calls.py:344 OpenAI Full Error Response (status 401): {
    "error": {
        "message": "Incorrect API key provided: invalid-key. You can find your API key at https://platform.openai.com/account/api-keys.",
        "type": "invalid_request_error",
        "param": null,
        "code": "invalid_api_key"
    }
}
----------------------------------------

203. ERROR    root:LLM_API_Calls.py:344 OpenAI Full Error Response (status 401): {
    "error": {
        "message": "Incorrect API key provided: test-key. You can find your API key at https://platform.openai.com/account/api-keys.",
        "type": "invalid_request_error",
        "param": null,
        "code": "invalid_api_key"
    }
}
_______________ TestMockedChatAPIs.test_chat_function_with_mock ________________
Tests/Chat/test_chat_mocked_apis.py:174: in test_chat_function_with_mock
    result = chat(
E   TypeError: chat() missing 4 required positional arguments: 'history', 'media_content', 'selected_parts', and 'custom_prompt'
______________ TestMockedChatAPIs.test_provider_parameter_mapping ______________
Tests/Chat/test_chat_mocked_apis.py:206: in test_provider_parameter_mapping
    assert openai_map["temperature"] == "temperature"
           ^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'temperature'
____________ TestTokenCounter.test_get_model_token_limit_by_prefix _____________
Tests/Chat/test_token_counter.py:55: in test_get_model_token_limit_by_prefix
    assert get_model_token_limit("claude-3-opus-custom") == 200000
E   AssertionError: assert 4096 == 200000
E    +  where 4096 = get_model_token_limit('claude-3-opus-custom')
=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/_hypothesis_pytestplugin.py:461
  /Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/_hypothesis_pytestplugin.py:461: UserWarning: Skipping collection of '.hypothesis' directory - this usually means you've explicitly set the `norecursedirs` pytest config option, replacing rather than extending the default ignores.
    warnings.warn(
----------------------------------------

204. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_search_initial_state
----------------------------------------

205. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_search_functionality
----------------------------------------

206. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_load_for_review
----------------------------------------

207. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_copy_buttons[chat-media-copy-title-button-title-Title copied to clipboard.]
----------------------------------------

208. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_copy_buttons[chat-media-copy-content-button-content-Content copied to clipboard.]
----------------------------------------

209. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_copy_buttons[chat-media-copy-author-button-author-Author copied to clipboard.]
----------------------------------------

210. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_copy_buttons[chat-media-copy-url-button-url-URL copied to clipboard.]
----------------------------------------

211. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_review_clearing_on_new_empty_search
----------------------------------------

212. ERROR Tests/Chat/test_chat_sidebar_media_search.py::test_media_search_input_debounced
----------------------------------------

213. FAILED Tests/Chat/test_chat_integration_APIs.py::test_provider_api_basic_call[koboldcpp]
----------------------------------------

214. FAILED Tests/Chat/test_chat_integration_APIs.py::test_provider_api_streaming_call[koboldcpp]
----------------------------------------

215. FAILED Tests/Chat/test_chat_mocked_apis.py::TestMockedChatAPIs::test_anthropic_chat_mocked
----------------------------------------

216. FAILED Tests/Chat/test_chat_mocked_apis.py::TestMockedChatAPIs::test_api_error_handling
----------------------------------------

217. FAILED Tests/Chat/test_chat_mocked_apis.py::TestMockedChatAPIs::test_chat_function_with_mock
----------------------------------------

218. FAILED Tests/Chat/test_chat_mocked_apis.py::TestMockedChatAPIs::test_provider_parameter_mapping
----------------------------------------

219. FAILED Tests/Chat/test_token_counter.py::TestTokenCounter::test_get_model_token_limit_by_prefix
7 failed, 58 passed, 39 skipped, 2 warnings, 9 errors in 4.74s
----------------------------------------

220. Tests/Chat/test_chat_integration_APIs.py::test_provider_api_basic_call[koboldcpp]: .venv/lib/python3.12/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.12/site-packages/urllib3/util/connection.py:85: in create_connection
    raise err
.venv/lib/python3.12/site-packages/urllib3/util/connection.py:73: in create_connection
    sock.connect(sa)
E   ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:
.venv/lib/python3.12/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.12/site-packages/urllib3/connectionpool.py:493: in _make_request
    conn.request(
.venv/lib/python3.12/site-packages/urllib3/connection.py:445: in request
    self.endheaders()
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py:1333: in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py:1093: in _send_output
    self.send(msg)
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py:1037: in send
    self.connect()
.venv/lib/python3.12/site-packages/urllib3/connection.py:276: in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/urllib3/connection.py:213: in _new_conn
    raise NewConnectionError(
E   urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x16491b290>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:
.venv/lib/python3.12/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.12/site-packages/urllib3/connectionpool.py:871: in urlopen
    return self.urlopen(
.venv/lib/python3.12/site-packages/urllib3/connectionpool.py:841: in urlopen
    retries = retries.increment(
.venv/lib/python3.12/site-packages/urllib3/util/retry.py:519: in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x16491b290>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:
tldw_chatbook/LLM_Calls/LLM_API_Calls_Local.py:546: in chat_with_kobold
    response = session.post(current_api_base_url, headers=headers, json=payload, timeout=timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/adapters.py:700: in send
    raise ConnectionError(e, request=request)
E   requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x16491b290>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:
Tests/Chat/test_chat_integration_APIs.py:181: in test_provider_api_basic_call
    response = chat_api_call(**params_for_call)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Chat/Chat_Functions.py:686: in chat_api_call
    raise e_chat_direct  # Re-raise the specific error
    ^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Chat/Chat_Functions.py:631: in chat_api_call
    response = handler(**call_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/LLM_Calls/LLM_API_Calls_Local.py:567: in chat_with_kobold
    raise ChatProviderError(provider="kobold", message=f"Network error calling KoboldAI (Native): {e_req}", status_code=503)
E   tldw_chatbook.Chat.Chat_Deps.ChatProviderError: Network error calling KoboldAI (Native): HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x16491b290>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:
Tests/Chat/test_chat_integration_APIs.py:190: in test_provider_api_basic_call
    pytest.warning(f"Provider {provider} returned a server error {e.status_code}: {e.message}")
    ^^^^^^^^^^^^^^
E   AttributeError: module 'pytest' has no attribute 'warning'
----------------------------------------

221. Tests/Chat/test_chat_integration_APIs.py::test_provider_api_streaming_call[koboldcpp]: .venv/lib/python3.12/site-packages/urllib3/connection.py:198: in _new_conn
    sock = connection.create_connection(
.venv/lib/python3.12/site-packages/urllib3/util/connection.py:85: in create_connection
    raise err
.venv/lib/python3.12/site-packages/urllib3/util/connection.py:73: in create_connection
    sock.connect(sa)
E   ConnectionRefusedError: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:
.venv/lib/python3.12/site-packages/urllib3/connectionpool.py:787: in urlopen
    response = self._make_request(
.venv/lib/python3.12/site-packages/urllib3/connectionpool.py:493: in _make_request
    conn.request(
.venv/lib/python3.12/site-packages/urllib3/connection.py:445: in request
    self.endheaders()
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py:1333: in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py:1093: in _send_output
    self.send(msg)
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/http/client.py:1037: in send
    self.connect()
.venv/lib/python3.12/site-packages/urllib3/connection.py:276: in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/urllib3/connection.py:213: in _new_conn
    raise NewConnectionError(
E   urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x166a08c50>: Failed to establish a new connection: [Errno 61] Connection refused

The above exception was the direct cause of the following exception:
.venv/lib/python3.12/site-packages/requests/adapters.py:667: in send
    resp = conn.urlopen(
.venv/lib/python3.12/site-packages/urllib3/connectionpool.py:871: in urlopen
    return self.urlopen(
.venv/lib/python3.12/site-packages/urllib3/connectionpool.py:841: in urlopen
    retries = retries.increment(
.venv/lib/python3.12/site-packages/urllib3/util/retry.py:519: in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x166a08c50>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:
tldw_chatbook/LLM_Calls/LLM_API_Calls_Local.py:546: in chat_with_kobold
    response = session.post(current_api_base_url, headers=headers, json=payload, timeout=timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/sessions.py:637: in post
    return self.request("POST", url, data=data, json=json, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/sessions.py:589: in request
    resp = self.send(prep, **send_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/sessions.py:703: in send
    r = adapter.send(request, **kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/adapters.py:700: in send
    raise ConnectionError(e, request=request)
E   requests.exceptions.ConnectionError: HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x166a08c50>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:
Tests/Chat/test_chat_integration_APIs.py:250: in test_provider_api_streaming_call
    response_generator = chat_api_call(**params_for_call)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Chat/Chat_Functions.py:686: in chat_api_call
    raise e_chat_direct  # Re-raise the specific error
    ^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Chat/Chat_Functions.py:631: in chat_api_call
    response = handler(**call_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/LLM_Calls/LLM_API_Calls_Local.py:567: in chat_with_kobold
    raise ChatProviderError(provider="kobold", message=f"Network error calling KoboldAI (Native): {e_req}", status_code=503)
E   tldw_chatbook.Chat.Chat_Deps.ChatProviderError: Network error calling KoboldAI (Native): HTTPConnectionPool(host='localhost', port=5001): Max retries exceeded with url: /api/v1/generate (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x166a08c50>: Failed to establish a new connection: [Errno 61] Connection refused'))

During handling of the above exception, another exception occurred:
Tests/Chat/test_chat_integration_APIs.py:255: in test_provider_api_streaming_call
    pytest.warning(f"Provider {provider} (streaming) returned server error {e.status_code}: {e.message}")
    ^^^^^^^^^^^^^^
E   AttributeError: module 'pytest' has no attribute 'warning'
----------------------------------------

222. Tests/Chat/test_chat_mocked_apis.py::TestMockedChatAPIs::test_anthropic_chat_mocked: tldw_chatbook/LLM_Calls/LLM_API_Calls.py:468: in chat_with_anthropic
    response.raise_for_status()
.venv/lib/python3.12/site-packages/requests/models.py:1024: in raise_for_status
    raise HTTPError(http_error_msg, response=self)
E   requests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: https://api.anthropic.com/v1/messages

The above exception was the direct cause of the following exception:
tldw_chatbook/Chat/Chat_Functions.py:631: in chat_api_call
    response = handler(**call_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/LLM_Calls/LLM_API_Calls.py:574: in chat_with_anthropic
    if status_code == 401: raise ChatAuthenticationError(provider="anthropic", message=f"Auth failed. Detail: {error_text[:200]}") from e
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   tldw_chatbook.Chat.Chat_Deps.ChatAuthenticationError: Auth failed. Detail: {"type":"error","error":{"type":"authentication_error","message":"invalid x-api-key"}}

During handling of the above exception, another exception occurred:
Tests/Chat/test_chat_mocked_apis.py:77: in test_anthropic_chat_mocked
    result = chat_api_call(
tldw_chatbook/Chat/Chat_Functions.py:683: in chat_api_call
    logger.error(
.venv/lib/python3.12/site-packages/loguru/_logger.py:2090: in error
    __self._log("ERROR", False, __self._options, __message, args, kwargs)
.venv/lib/python3.12/site-packages/loguru/_logger.py:2055: in _log
    log_record["message"] = message.format(*args, **kwargs)
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: '"type"'
----------------------------------------

223. Tests/Chat/test_chat_mocked_apis.py::TestMockedChatAPIs::test_api_error_handling: tldw_chatbook/Chat/Chat_Functions.py:631: in chat_api_call
    response = handler(**call_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/LLM_Calls/LLM_API_Calls.py:335: in chat_with_openai
    response.raise_for_status()  # Raise HTTPError for 4xx/5xx AFTER retries
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/requests/models.py:1024: in raise_for_status
    raise HTTPError(http_error_msg, response=self)
E   requests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: https://api.openai.com/v1/chat/completions

During handling of the above exception, another exception occurred:
Tests/Chat/test_chat_mocked_apis.py:161: in test_api_error_handling
    chat_api_call(
tldw_chatbook/Chat/Chat_Functions.py:659: in chat_api_call
    raise ChatAuthenticationError(provider=endpoint_lower,
E   tldw_chatbook.Chat.Chat_Deps.ChatAuthenticationError: Authentication failed for openai. Check API key. Detail: {
E       "error": {
E           "message": "Incorrect API key provided: test-key. You can find your API key at https://platform.openai.com/account/api-keys.",
E           "type": "invalid_request_error",
----------------------------------------

224. Tests/Chat/test_chat_mocked_apis.py::TestMockedChatAPIs::test_chat_function_with_mock: Tests/Chat/test_chat_mocked_apis.py:174: in test_chat_function_with_mock
    result = chat(
E   TypeError: chat() missing 4 required positional arguments: 'history', 'media_content', 'selected_parts', and 'custom_prompt'
----------------------------------------

225. Tests/Chat/test_chat_mocked_apis.py::TestMockedChatAPIs::test_provider_parameter_mapping: Tests/Chat/test_chat_mocked_apis.py:206: in test_provider_parameter_mapping
    assert openai_map["temperature"] == "temperature"
           ^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'temperature'
----------------------------------------

226. Tests/Chat/test_chat_sidebar_media_search.py::test_media_search_initial_state: No details available
----------------------------------------

227. Tests/Chat/test_chat_sidebar_media_search.py::test_media_search_functionality: No details available
----------------------------------------

228. Tests/Chat/test_chat_sidebar_media_search.py::test_media_load_for_review: No details available
----------------------------------------

229. Tests/Chat/test_chat_sidebar_media_search.py::test_media_copy_buttons[chat-media-copy-title-button-title-Title copied to clipboard.]: No details available
----------------------------------------

230. Tests/Chat/test_chat_sidebar_media_search.py::test_media_copy_buttons[chat-media-copy-content-button-content-Content copied to clipboard.]: No details available
----------------------------------------

231. Tests/Chat/test_chat_sidebar_media_search.py::test_media_copy_buttons[chat-media-copy-author-button-author-Author copied to clipboard.]: No details available
----------------------------------------

232. Tests/Chat/test_chat_sidebar_media_search.py::test_media_copy_buttons[chat-media-copy-url-button-url-URL copied to clipboard.]: No details available
----------------------------------------

233. Tests/Chat/test_chat_sidebar_media_search.py::test_media_review_clearing_on_new_empty_search: No details available
----------------------------------------

234. Tests/Chat/test_chat_sidebar_media_search.py::test_media_search_input_debounced: No details available
----------------------------------------

235. Tests/Chat/test_token_counter.py::TestTokenCounter::test_get_model_token_limit_by_prefix: Tests/Chat/test_token_counter.py:55: in test_get_model_token_limit_by_prefix
    assert get_model_token_limit("claude-3-opus-custom") == 200000
E   AssertionError: assert 4096 == 200000
E    +  where 4096 = get_model_token_limit('claude-3-opus-custom')
----------------------------------------

================================================================================

Directory: Notes
Duration: 0.34s
Passed: 0, Failed: 0, Skipped: 0, Errors: 0

Failures:

1. ==================================== ERRORS ====================================
----------------------------------------

2. ____________ ERROR collecting Tests/Notes/test_notes_integration.py ____________
ImportError while importing test module '/Users/appledev/Working/tldw_chatbook_dev/Tests/Notes/test_notes_integration.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Tests/Notes/test_notes_integration.py:14: in <module>
    from tldw_chatbook.Notes.Notes_Library import NotesLibrary
E   ImportError: cannot import name 'NotesLibrary' from 'tldw_chatbook.Notes.Notes_Library' (/Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Notes/Notes_Library.py)
------------------------------- Captured stderr --------------------------------
2025-06-28 21:11:35.929 | DEBUG    | tldw_chatbook.config:<module>:29 - CRITICAL DEBUG: config.py module is being imported/executed NOW.
2025-06-28 21:11:35.929 | INFO     | tldw_chatbook.config:load_openai_mappings:130 - Attempting to load OpenAI TTS mappings from: /Users/appledev/Working/Config_Files/openai_tts_mappings.json
----------------------------------------

3. 2025-06-28 21:11:35.929 | ERROR    | tldw_chatbook.config:load_openai_mappings:135 - Failed to load OpenAI TTS mappings from /Users/appledev/Working/Config_Files/openai_tts_mappings.json: [Errno 2] No such file or directory: '/Users/appledev/Working/Config_Files/openai_tts_mappings.json'
2025-06-28 21:11:35.932 | INFO     | tldw_chatbook.config:load_cli_config_and_ensure_existence:1614 - Attempting to load CLI config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:35.934 | INFO     | tldw_chatbook.config:load_cli_config_and_ensure_existence:1620 - Successfully loaded and merged CLI config from /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:35.934 | DEBUG    | tldw_chatbook.config:load_cli_config_and_ensure_existence:1630 - load_cli_config_and_ensure_existence returning config with top-level keys: ['general', 'tldw_api', 'logging', 'database', 'api_endpoints', 'providers', 'api_settings', 'chat_defaults', 'character_defaults', 'Prompts', 'embedding_config', 'rag', 'rag_search']
2025-06-28 21:11:35.934 | DEBUG    | tldw_chatbook.config:load_cli_config_and_ensure_existence:1632 -   'api_settings' found with keys: ['openai', 'anthropic', 'cohere', 'deepseek', 'groq', 'google', 'huggingface', 'mistralai', 'openrouter', 'llama_cpp', 'oobabooga', 'koboldcpp', 'ollama', 'vllm', 'aphrodite', 'tabbyapi', 'custom', 'custom_2', 'local-llm', 'local_llamafile', 'local_llamacpp', 'local_vllm', 'local_ollama', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:11:35.934 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:35.934 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:11:35.934 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:11:35.934 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:11:35.934 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:35.935 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:11:35.936 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:11:35.936 | INFO     | tldw_chatbook.config:<module>:1851 - Default API Endpoint (from config.py global scope): openai
2025-06-28 21:11:35.936 | DEBUG    | tldw_chatbook.config:<module>:1871 - CRITICAL DEBUG: CALLING initialize_all_databases() from config.py module level.
2025-06-28 21:11:35.936 | DEBUG    | tldw_chatbook.config:initialize_all_databases:1785 - CRITICAL DEBUG: INSIDE initialize_all_databases() NOW.
2025-06-28 21:11:35.936 | INFO     | tldw_chatbook.config:initialize_all_databases:1786 - Initializing CLI databases...
2025-06-28 21:11:35.936 | INFO     | tldw_chatbook.config:initialize_all_databases:1789 - Attempting to initialize ChaChaNotes_DB at: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:35.936 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:11:35.937 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 5. Code supports: 5
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1407 - Database schema 'rag_char_chat_schema' is up to date (Version 5).
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:35.937 | SUCCESS  | tldw_chatbook.config:initialize_all_databases:1792 - ChaChaNotes_DB initialized successfully at /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:11:35.937 | INFO     | tldw_chatbook.config:initialize_all_databases:1798 - Attempting to initialize Prompts_DB at: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:35.937 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:11:35.937 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:11:35.937 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:35.937 | SUCCESS  | tldw_chatbook.config:initialize_all_databases:1801 - Prompts_DB initialized successfully at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:11:35.937 | INFO     | tldw_chatbook.config:initialize_all_databases:1807 - Attempting to initialize Media_DB_v2 at: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:35.938 | SUCCESS  | tldw_chatbook.config:initialize_all_databases:1810 - Media_DB_v2 initialized successfully at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:11:35.938 | INFO     | tldw_chatbook.config:initialize_all_databases:1814 - CLI database initialization complete.
=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/_hypothesis_pytestplugin.py:461
  /Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/_hypothesis_pytestplugin.py:461: UserWarning: Skipping collection of '.hypothesis' directory - this usually means you've explicitly set the `norecursedirs` pytest config option, replacing rather than extending the default ignores.
    warnings.warn(
----------------------------------------

4. ERROR Tests/Notes/test_notes_integration.py
!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
1 skipped, 1 warning, 1 error in 0.15s
----------------------------------------

================================================================================

Directory: LLM_Management
Duration: 5.46s
Passed: 27, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: Evals
Duration: 33.88s
Passed: 54, Failed: 84, Skipped: 0, Errors: 7

Failures:

1. ==================================== ERRORS ====================================
----------------------------------------

2. ____ ERROR at setup of TestDatabaseProperties.test_task_roundtrip_property _____
file /Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py, line 137
      @given(task_config_strategy())
      @settings(max_examples=20, deadline=None)
      def test_task_roundtrip_property(self, task_config, in_memory_db):
E       fixture 'task_config' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, async_setup, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, eval_orchestrator, eval_runner, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, in_memory_db, include_metadata_in_junit_xml, json_metadata, large_dataset_config, metadata, mock_failing_llm, mock_llm_interface, mock_successful_llm, mocker, module_mocker, monkeypatch, package_mocker, performance_test_samples, property_test_data, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_code_config, sample_csv_dataset_file, sample_custom_task_file, sample_eleuther_task_file, sample_eval_results, sample_gsm8k_config, sample_task_config, session_mocker, task_loader, temp_db, temp_db_path, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

3. ___ ERROR at setup of TestDatabaseProperties.test_multiple_tasks_uniqueness ____
file /Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py, line 160
      @given(st.lists(task_config_strategy(), min_size=1, max_size=10))
      @settings(max_examples=10, deadline=None)
      def test_multiple_tasks_uniqueness(self, task_configs, in_memory_db):
E       fixture 'task_configs' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, async_setup, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, eval_orchestrator, eval_runner, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, in_memory_db, include_metadata_in_junit_xml, json_metadata, large_dataset_config, metadata, mock_failing_llm, mock_llm_interface, mock_successful_llm, mocker, module_mocker, monkeypatch, package_mocker, performance_test_samples, property_test_data, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_code_config, sample_csv_dataset_file, sample_custom_task_file, sample_eleuther_task_file, sample_eval_results, sample_gsm8k_config, sample_task_config, session_mocker, task_loader, temp_db, temp_db_path, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

4. _______ ERROR at setup of TestDatabaseProperties.test_search_consistency _______
file /Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py, line 186
      @given(st.text(min_size=1, max_size=100))
      @settings(max_examples=20, deadline=None)
      def test_search_consistency(self, search_term, in_memory_db):
E       fixture 'search_term' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, async_setup, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, eval_orchestrator, eval_runner, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, in_memory_db, include_metadata_in_junit_xml, json_metadata, large_dataset_config, metadata, mock_failing_llm, mock_llm_interface, mock_successful_llm, mocker, module_mocker, monkeypatch, package_mocker, performance_test_samples, property_test_data, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_code_config, sample_csv_dataset_file, sample_custom_task_file, sample_eleuther_task_file, sample_eval_results, sample_gsm8k_config, sample_task_config, session_mocker, task_loader, temp_db, temp_db_path, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

5. _____ ERROR at setup of TestDatabaseProperties.test_pagination_properties ______
file /Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py, line 227
      @given(st.integers(min_value=1, max_value=100))
      @settings(max_examples=10, deadline=None)
      def test_pagination_properties(self, total_tasks, in_memory_db):
E       fixture 'total_tasks' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, async_setup, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, eval_orchestrator, eval_runner, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, in_memory_db, include_metadata_in_junit_xml, json_metadata, large_dataset_config, metadata, mock_failing_llm, mock_llm_interface, mock_successful_llm, mocker, module_mocker, monkeypatch, package_mocker, performance_test_samples, property_test_data, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_code_config, sample_csv_dataset_file, sample_custom_task_file, sample_eleuther_task_file, sample_eval_results, sample_gsm8k_config, sample_task_config, session_mocker, task_loader, temp_db, temp_db_path, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

6. _ ERROR at setup of TestConcurrencyProperties.test_concurrent_task_creation_uniqueness _
file /Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py, line 493
      @given(st.lists(st.text(min_size=1, max_size=50), min_size=2, max_size=10, unique=True))
      @settings(max_examples=10, deadline=None)
      def test_concurrent_task_creation_uniqueness(self, task_names, temp_db):
E       fixture 'task_names' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, async_setup, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, eval_orchestrator, eval_runner, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, in_memory_db, include_metadata_in_junit_xml, json_metadata, large_dataset_config, metadata, mock_failing_llm, mock_llm_interface, mock_successful_llm, mocker, module_mocker, monkeypatch, package_mocker, performance_test_samples, property_test_data, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_code_config, sample_csv_dataset_file, sample_custom_task_file, sample_eleuther_task_file, sample_eval_results, sample_gsm8k_config, sample_task_config, session_mocker, task_loader, temp_db, temp_db_path, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

7. ____ ERROR at setup of TestSystemInvariants.test_resource_cleanup_invariant ____
file /Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py, line 572
      @given(st.integers(min_value=1, max_value=50))
      @settings(max_examples=5, deadline=None)
      def test_resource_cleanup_invariant(self, num_operations, temp_db):
E       fixture 'num_operations' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, async_setup, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, eval_orchestrator, eval_runner, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, in_memory_db, include_metadata_in_junit_xml, json_metadata, large_dataset_config, metadata, mock_failing_llm, mock_llm_interface, mock_successful_llm, mocker, module_mocker, monkeypatch, package_mocker, performance_test_samples, property_test_data, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_code_config, sample_csv_dataset_file, sample_custom_task_file, sample_eleuther_task_file, sample_eval_results, sample_gsm8k_config, sample_task_config, session_mocker, task_loader, temp_db, temp_db_path, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

8. __ ERROR at setup of TestSystemInvariants.test_database_consistency_invariant __
file /Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py, line 606
      @given(st.lists(
          st.tuples(
              st.text(min_size=1, max_size=20),  # operation type
              st.dictionaries(st.text(), st.text(), max_size=3)  # operation data
          ),
          min_size=1,
          max_size=20
      ))
      @settings(max_examples=5, deadline=None)
      def test_database_consistency_invariant(self, operations, temp_db):
E       fixture 'operations' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, async_setup, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, eval_orchestrator, eval_runner, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, in_memory_db, include_metadata_in_junit_xml, json_metadata, large_dataset_config, metadata, mock_failing_llm, mock_llm_interface, mock_successful_llm, mocker, module_mocker, monkeypatch, package_mocker, performance_test_samples, property_test_data, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_code_config, sample_csv_dataset_file, sample_custom_task_file, sample_eleuther_task_file, sample_eval_results, sample_gsm8k_config, sample_task_config, session_mocker, task_loader, temp_db, temp_db_path, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

9. ERROR Tests/Evals/test_eval_properties.py::TestDatabaseProperties::test_task_roundtrip_property
----------------------------------------

10. ERROR Tests/Evals/test_eval_properties.py::TestDatabaseProperties::test_multiple_tasks_uniqueness
----------------------------------------

11. ERROR Tests/Evals/test_eval_properties.py::TestDatabaseProperties::test_search_consistency
----------------------------------------

12. ERROR Tests/Evals/test_eval_properties.py::TestDatabaseProperties::test_pagination_properties
----------------------------------------

13. ERROR Tests/Evals/test_eval_properties.py::TestConcurrencyProperties::test_concurrent_task_creation_uniqueness
----------------------------------------

14. ERROR Tests/Evals/test_eval_properties.py::TestSystemInvariants::test_resource_cleanup_invariant
----------------------------------------

15. ERROR Tests/Evals/test_eval_properties.py::TestSystemInvariants::test_database_consistency_invariant
----------------------------------------

16. FAILED Tests/Evals/test_eval_integration.py::TestEndToEndEvaluation::test_complete_evaluation_pipeline
----------------------------------------

17. FAILED Tests/Evals/test_eval_integration.py::TestEndToEndEvaluation::test_eleuther_task_integration
----------------------------------------

18. FAILED Tests/Evals/test_eval_integration.py::TestEndToEndEvaluation::test_csv_dataset_integration
----------------------------------------

19. FAILED Tests/Evals/test_eval_integration.py::TestMultiProviderIntegration::test_multiple_provider_evaluation
----------------------------------------

20. FAILED Tests/Evals/test_eval_integration.py::TestMultiProviderIntegration::test_provider_fallback_mechanism
----------------------------------------

21. FAILED Tests/Evals/test_eval_integration.py::TestSpecializedTaskIntegration::test_code_evaluation_integration
----------------------------------------

22. FAILED Tests/Evals/test_eval_integration.py::TestSpecializedTaskIntegration::test_safety_evaluation_integration
----------------------------------------

23. FAILED Tests/Evals/test_eval_integration.py::TestSpecializedTaskIntegration::test_multilingual_evaluation_integration
----------------------------------------

24. FAILED Tests/Evals/test_eval_integration.py::TestConcurrentEvaluations::test_concurrent_runs_same_task
----------------------------------------

25. FAILED Tests/Evals/test_eval_integration.py::TestConcurrentEvaluations::test_concurrent_task_creation
----------------------------------------

26. FAILED Tests/Evals/test_eval_integration.py::TestErrorRecoveryIntegration::test_partial_failure_recovery
----------------------------------------

27. FAILED Tests/Evals/test_eval_integration.py::TestErrorRecoveryIntegration::test_database_recovery_integration
----------------------------------------

28. FAILED Tests/Evals/test_eval_integration.py::TestPerformanceIntegration::test_large_scale_evaluation
----------------------------------------

29. FAILED Tests/Evals/test_eval_integration.py::TestPerformanceIntegration::test_memory_efficiency_integration
----------------------------------------

30. FAILED Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_exact_match_symmetry
----------------------------------------

31. FAILED Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_exact_match_reflexivity
----------------------------------------

32. FAILED Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_contains_answer_monotonicity
----------------------------------------

33. FAILED Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_metrics_aggregation_properties
----------------------------------------

34. FAILED Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_eval_result_invariants
----------------------------------------

35. FAILED Tests/Evals/test_eval_properties.py::TestTaskConfigurationProperties::test_generation_kwargs_validation
----------------------------------------

36. FAILED Tests/Evals/test_eval_properties.py::TestFileHandlingProperties::test_text_processing_robustness
----------------------------------------

37. FAILED Tests/Evals/test_eval_properties.py::TestConcurrencyProperties::test_evaluation_order_independence
----------------------------------------

38. FAILED Tests/Evals/test_eval_runner.py::TestEvalSampleResult::test_eval_result_with_error
----------------------------------------

39. FAILED Tests/Evals/test_eval_runner.py::TestEvalProgress::test_eval_progress_creation
----------------------------------------

40. FAILED Tests/Evals/test_eval_runner.py::TestEvalProgress::test_progress_percentage
----------------------------------------

41. FAILED Tests/Evals/test_eval_runner.py::TestEvalProgress::test_estimated_time_remaining
----------------------------------------

42. FAILED Tests/Evals/test_eval_runner.py::TestEvalRunnerInitialization::test_eval_runner_creation
----------------------------------------

43. FAILED Tests/Evals/test_eval_runner.py::TestEvalRunnerInitialization::test_eval_runner_with_config
----------------------------------------

44. FAILED Tests/Evals/test_eval_runner.py::TestBasicEvaluation::test_run_single_sample
----------------------------------------

45. FAILED Tests/Evals/test_eval_runner.py::TestBasicEvaluation::test_run_multiple_samples
----------------------------------------

46. FAILED Tests/Evals/test_eval_runner.py::TestBasicEvaluation::test_run_with_progress_callback
----------------------------------------

47. FAILED Tests/Evals/test_eval_runner.py::TestDifferentTaskTypes::test_question_answer_task
----------------------------------------

48. FAILED Tests/Evals/test_eval_runner.py::TestDifferentTaskTypes::test_multiple_choice_task
----------------------------------------

49. FAILED Tests/Evals/test_eval_runner.py::TestDifferentTaskTypes::test_text_generation_task
----------------------------------------

50. FAILED Tests/Evals/test_eval_runner.py::TestDifferentTaskTypes::test_code_generation_task
----------------------------------------

51. FAILED Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_exact_match_metric
----------------------------------------

52. FAILED Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_contains_answer_metric
----------------------------------------

53. FAILED Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_bleu_score_metric
----------------------------------------

54. FAILED Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_f1_score_metric
----------------------------------------

55. FAILED Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_code_execution_metric
----------------------------------------

56. FAILED Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_safety_metrics
----------------------------------------

57. FAILED Tests/Evals/test_eval_runner.py::TestErrorHandling::test_api_timeout_handling
----------------------------------------

58. FAILED Tests/Evals/test_eval_runner.py::TestErrorHandling::test_retry_mechanism
----------------------------------------

59. FAILED Tests/Evals/test_eval_runner.py::TestErrorHandling::test_partial_failure_handling
----------------------------------------

60. FAILED Tests/Evals/test_eval_runner.py::TestConcurrencyAndPerformance::test_concurrent_execution
----------------------------------------

61. FAILED Tests/Evals/test_eval_runner.py::TestConcurrencyAndPerformance::test_memory_efficient_streaming
----------------------------------------

62. FAILED Tests/Evals/test_eval_runner.py::TestConcurrencyAndPerformance::test_cancellation_support
----------------------------------------

63. FAILED Tests/Evals/test_eval_runner.py::TestAdvancedFeatures::test_few_shot_prompting
----------------------------------------

64. FAILED Tests/Evals/test_eval_runner.py::TestAdvancedFeatures::test_custom_prompt_templates
----------------------------------------

65. FAILED Tests/Evals/test_eval_runner.py::TestAdvancedFeatures::test_response_filtering
----------------------------------------

66. FAILED Tests/Evals/test_eval_runner.py::TestSpecializedEvaluations::test_multilingual_evaluation
----------------------------------------

67. FAILED Tests/Evals/test_eval_runner.py::TestSpecializedEvaluations::test_math_evaluation
----------------------------------------

68. FAILED Tests/Evals/test_eval_runner.py::TestSpecializedEvaluations::test_safety_evaluation
----------------------------------------

69. FAILED Tests/Evals/test_evals_db.py::TestDatasetOperations::test_get_dataset
----------------------------------------

70. FAILED Tests/Evals/test_evals_db.py::TestRunOperations::test_create_run - Typ...
----------------------------------------

71. FAILED Tests/Evals/test_evals_db.py::TestRunOperations::test_get_run - TypeEr...
----------------------------------------

72. FAILED Tests/Evals/test_evals_db.py::TestRunOperations::test_update_run_status
----------------------------------------

73. FAILED Tests/Evals/test_evals_db.py::TestResultOperations::test_store_result
----------------------------------------

74. FAILED Tests/Evals/test_evals_db.py::TestResultOperations::test_get_results_for_run
----------------------------------------

75. FAILED Tests/Evals/test_evals_db.py::TestMetricsOperations::test_store_run_metrics
----------------------------------------

76. FAILED Tests/Evals/test_evals_db.py::TestMetricsOperations::test_get_run_metrics
----------------------------------------

77. FAILED Tests/Evals/test_evals_db.py::TestSearchOperations::test_search_datasets
----------------------------------------

78. FAILED Tests/Evals/test_evals_db.py::TestErrorHandling::test_foreign_key_violation
----------------------------------------

79. FAILED Tests/Evals/test_evals_db.py::TestErrorHandling::test_concurrent_modification
----------------------------------------

80. FAILED Tests/Evals/test_evals_db.py::TestThreadSafety::test_concurrent_read_write
----------------------------------------

81. FAILED Tests/Evals/test_task_loader.py::TestEleutherFormatLoading::test_load_eleuther_with_templates
----------------------------------------

82. FAILED Tests/Evals/test_task_loader.py::TestEleutherFormatLoading::test_load_eleuther_complex_config
----------------------------------------

83. FAILED Tests/Evals/test_task_loader.py::TestCustomFormatLoading::test_load_custom_with_fewshot
----------------------------------------

84. FAILED Tests/Evals/test_task_loader.py::TestHuggingFaceFormatLoading::test_load_huggingface_basic
----------------------------------------

85. FAILED Tests/Evals/test_task_loader.py::TestHuggingFaceFormatLoading::test_load_huggingface_with_config
----------------------------------------

86. FAILED Tests/Evals/test_task_loader.py::TestTaskValidation::test_validate_missing_required_fields
----------------------------------------

87. FAILED Tests/Evals/test_task_loader.py::TestTaskValidation::test_validate_generation_kwargs
----------------------------------------

88. FAILED Tests/Evals/test_task_loader.py::TestTaskValidation::test_validate_code_task_requirements
----------------------------------------

89. FAILED Tests/Evals/test_task_loader.py::TestErrorHandling::test_invalid_yaml_syntax
----------------------------------------

90. FAILED Tests/Evals/test_task_loader.py::TestErrorHandling::test_invalid_json_syntax
----------------------------------------

91. FAILED Tests/Evals/test_task_loader.py::TestFormatConversion::test_eleuther_to_custom_conversion
----------------------------------------

92. FAILED Tests/Evals/test_task_loader.py::TestFormatConversion::test_custom_to_eleuther_conversion
----------------------------------------

93. FAILED Tests/Evals/test_task_loader.py::TestTaskTemplateGeneration::test_generate_basic_template
----------------------------------------

94. FAILED Tests/Evals/test_task_loader.py::TestTaskTemplateGeneration::test_generate_code_template
----------------------------------------

95. FAILED Tests/Evals/test_task_loader.py::TestTaskTemplateGeneration::test_generate_eleuther_template
----------------------------------------

96. FAILED Tests/Evals/test_task_loader.py::TestUtilityFunctions::test_detect_file_format
----------------------------------------

97. FAILED Tests/Evals/test_task_loader.py::TestUtilityFunctions::test_normalize_task_type
----------------------------------------

98. FAILED Tests/Evals/test_task_loader.py::TestUtilityFunctions::test_validate_dataset_path
----------------------------------------

99. FAILED Tests/Evals/test_task_loader.py::TestUtilityFunctions::test_merge_generation_kwargs
84 failed, 54 passed, 2 warnings, 7 errors in 33.06s
----------------------------------------

100. Tests/Evals/test_eval_integration.py::TestEndToEndEvaluation::test_complete_evaluation_pipeline: Tests/Evals/test_eval_integration.py:91: in test_complete_evaluation_pipeline
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10b99d250> does not have the attribute '_create_llm_interface'
----------------------------------------

101. Tests/Evals/test_eval_integration.py::TestEndToEndEvaluation::test_eleuther_task_integration: Tests/Evals/test_eval_integration.py:165: in test_eleuther_task_integration
    task_id = await orchestrator.create_task_from_file(str(task_file), 'eleuther')
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Evals/eval_orchestrator.py:71: in create_task_from_file
    raise ValueError(f"Task validation failed: {validation_issues}")
E   ValueError: Task validation failed: ['doc_to_choice required for classification tasks']
----------------------------------------

102. Tests/Evals/test_eval_integration.py::TestEndToEndEvaluation::test_csv_dataset_integration: Tests/Evals/test_eval_integration.py:209: in test_csv_dataset_integration
    task_id = await orchestrator.create_task_from_file(str(csv_file), 'csv')
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Evals/eval_orchestrator.py:74: in create_task_from_file
    task_id = self.db.create_task(
tldw_chatbook/DB/Evals_DB.py:328: in create_task
    raise InputError(f"Invalid config_format: {config_format}")
E   tldw_chatbook.DB.Evals_DB.InputError: Invalid config_format: csv
----------------------------------------

103. Tests/Evals/test_eval_integration.py::TestMultiProviderIntegration::test_multiple_provider_evaluation: Tests/Evals/test_eval_integration.py:286: in test_multiple_provider_evaluation
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10ba402f0> does not have the attribute '_create_llm_interface'
----------------------------------------

104. Tests/Evals/test_eval_integration.py::TestMultiProviderIntegration::test_provider_fallback_mechanism: Tests/Evals/test_eval_integration.py:350: in test_provider_fallback_mechanism
    with patch.object(orchestrator, '_create_llm_interface', side_effect=mock_llm_factory):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10b9bc920> does not have the attribute '_create_llm_interface'
----------------------------------------

105. Tests/Evals/test_eval_integration.py::TestSpecializedTaskIntegration::test_code_evaluation_integration: Tests/Evals/test_eval_integration.py:378: in test_code_evaluation_integration
    task_id = orchestrator.db.create_task(
tldw_chatbook/DB/Evals_DB.py:325: in create_task
    raise InputError(f"Invalid task_type: {task_type}")
E   tldw_chatbook.DB.Evals_DB.InputError: Invalid task_type: code_generation
----------------------------------------

106. Tests/Evals/test_eval_integration.py::TestSpecializedTaskIntegration::test_safety_evaluation_integration: Tests/Evals/test_eval_integration.py:432: in test_safety_evaluation_integration
    task_id = orchestrator.db.create_task(
tldw_chatbook/DB/Evals_DB.py:325: in create_task
    raise InputError(f"Invalid task_type: {task_type}")
E   tldw_chatbook.DB.Evals_DB.InputError: Invalid task_type: safety_check
----------------------------------------

107. Tests/Evals/test_eval_integration.py::TestSpecializedTaskIntegration::test_multilingual_evaluation_integration: Tests/Evals/test_eval_integration.py:534: in test_multilingual_evaluation_integration
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10ba32450> does not have the attribute '_create_llm_interface'
----------------------------------------

108. Tests/Evals/test_eval_integration.py::TestConcurrentEvaluations::test_concurrent_runs_same_task: Tests/Evals/test_eval_integration.py:607: in test_concurrent_runs_same_task
    run_ids = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Tests/Evals/test_eval_integration.py:594: in run_evaluation_with_mock
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10ba31340> does not have the attribute '_create_llm_interface'
----------------------------------------

109. Tests/Evals/test_eval_integration.py::TestConcurrentEvaluations::test_concurrent_task_creation: Tests/Evals/test_eval_integration.py:675: in test_concurrent_task_creation
    run_ids = await asyncio.gather(*tasks)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Tests/Evals/test_eval_integration.py:662: in create_and_run_task
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10b9bebd0> does not have the attribute '_create_llm_interface'
----------------------------------------

110. Tests/Evals/test_eval_integration.py::TestErrorRecoveryIntegration::test_partial_failure_recovery: Tests/Evals/test_eval_integration.py:726: in test_partial_failure_recovery
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10baa5190> does not have the attribute '_create_llm_interface'
----------------------------------------

111. Tests/Evals/test_eval_integration.py::TestErrorRecoveryIntegration::test_database_recovery_integration: Tests/Evals/test_eval_integration.py:787: in test_database_recovery_integration
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10ba7bbf0> does not have the attribute '_create_llm_interface'
----------------------------------------

112. Tests/Evals/test_eval_integration.py::TestPerformanceIntegration::test_large_scale_evaluation: Tests/Evals/test_eval_integration.py:839: in test_large_scale_evaluation
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10ba7b650> does not have the attribute '_create_llm_interface'
----------------------------------------

113. Tests/Evals/test_eval_integration.py::TestPerformanceIntegration::test_memory_efficiency_integration: Tests/Evals/test_eval_integration.py:899: in test_memory_efficiency_integration
    with patch.object(orchestrator, '_create_llm_interface', return_value=mock_llm):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <tldw_chatbook.Evals.eval_orchestrator.EvaluationOrchestrator object at 0x10ba7ab70> does not have the attribute '_create_llm_interface'
----------------------------------------

114. Tests/Evals/test_eval_properties.py::TestDatabaseProperties::test_task_roundtrip_property: No details available
----------------------------------------

115. Tests/Evals/test_eval_properties.py::TestDatabaseProperties::test_multiple_tasks_uniqueness: No details available
----------------------------------------

116. Tests/Evals/test_eval_properties.py::TestDatabaseProperties::test_search_consistency: No details available
----------------------------------------

117. Tests/Evals/test_eval_properties.py::TestDatabaseProperties::test_pagination_properties: No details available
----------------------------------------

118. Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_exact_match_symmetry: Tests/Evals/test_eval_properties.py:276: in test_exact_match_symmetry
    @settings(max_examples=50, deadline=None)
               ^^^^^^^
Tests/Evals/test_eval_properties.py:279: in test_exact_match_symmetry
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
E   Falsifying example: test_exact_match_symmetry(
E       # The test always failed when commented parts were varied together.
E       self=<Tests.Evals.test_eval_properties.TestEvaluationProperties object at 0x10b8b4b90>,
E       text1='',  # or any other generated value
E       text2='',  # or any other generated value
E   )
----------------------------------------

119. Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_exact_match_reflexivity: Tests/Evals/test_eval_properties.py:287: in test_exact_match_reflexivity
    @settings(max_examples=30, deadline=None)
               ^^^^^^^
Tests/Evals/test_eval_properties.py:290: in test_exact_match_reflexivity
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
E   Falsifying example: test_exact_match_reflexivity(
E       self=<Tests.Evals.test_eval_properties.TestEvaluationProperties object at 0x10b8b7440>,
E       text='',  # or any other generated value
E   )
----------------------------------------

120. Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_contains_answer_monotonicity: Tests/Evals/test_eval_properties.py:296: in test_contains_answer_monotonicity
    @settings(max_examples=50, deadline=None)
               ^^^^^^^
Tests/Evals/test_eval_properties.py:299: in test_contains_answer_monotonicity
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
E   Falsifying example: test_contains_answer_monotonicity(
E       self=<Tests.Evals.test_eval_properties.TestEvaluationProperties object at 0x10b8b7590>,
E       answer='',
E       response='',
E   )
----------------------------------------

121. Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_metrics_aggregation_properties: Tests/Evals/test_eval_properties.py:314: in test_metrics_aggregation_properties
    @settings(max_examples=30, deadline=None)
               ^^^^^^^
Tests/Evals/test_eval_properties.py:317: in test_metrics_aggregation_properties
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
E   Falsifying example: test_metrics_aggregation_properties(
E       self=<Tests.Evals.test_eval_properties.TestEvaluationProperties object at 0x10b8b6930>,
E       scores=[0.0],
E   )
----------------------------------------

122. Tests/Evals/test_eval_properties.py::TestEvaluationProperties::test_eval_result_invariants: Tests/Evals/test_eval_properties.py:337: in test_eval_result_invariants
    @settings(max_examples=20, deadline=None)
               ^^^^^^^
Tests/Evals/test_eval_properties.py:98: in eval_result_strategy
    return EvalSampleResult(
E   TypeError: EvalSampleResult.__init__() got an unexpected keyword argument 'error'
E   while generating 'eval_result' from eval_result_strategy()
----------------------------------------

123. Tests/Evals/test_eval_properties.py::TestTaskConfigurationProperties::test_generation_kwargs_validation: + Exception Group Traceback (most recent call last):
  |   File "/Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py", line 383, in test_generation_kwargs_validation
  |     keys=st.sampled_from(["temperature", "max_tokens", "top_p", "top_k"]),
  |            ^^^^^^^
  |   File "/Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/hypothesis/core.py", line 2047, in wrapped_test
  |     raise the_error_hypothesis_found
  | ExceptionGroup: Hypothesis found 3 distinct failures. (3 sub-exceptions)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py", line 412, in test_generation_kwargs_validation
    |     assert any("top_p" in issue.lower() for issue in issues)
    | AssertionError: assert False
    |  +  where False = any(<generator object TestTaskConfigurationProperties.test_generation_kwargs_validation.<locals>.<genexpr> at 0x10bf5d8a0>)
    | Falsifying example: test_generation_kwargs_validation(
    |     self=<Tests.Evals.test_eval_properties.TestTaskConfigurationProperties object at 0x10b8b7620>,
    |     generation_kwargs={'top_p': -1.0},
    | )
    +---------------- 2 ----------------
    | Traceback (most recent call last):
    |   File "/Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py", line 410, in test_generation_kwargs_validation
    |     assert any("max_tokens" in issue.lower() for issue in issues)
    | AssertionError: assert False
    |  +  where False = any(<generator object TestTaskConfigurationProperties.test_generation_kwargs_validation.<locals>.<genexpr> at 0x10bcc3780>)
    | Falsifying example: test_generation_kwargs_validation(
    |     self=<Tests.Evals.test_eval_properties.TestTaskConfigurationProperties object at 0x10b8b7620>,
    |     generation_kwargs={'max_tokens': 0.0},
    | )
    +---------------- 3 ----------------
    | Traceback (most recent call last):
    |   File "/Users/appledev/Working/tldw_chatbook_dev/Tests/Evals/test_eval_properties.py", line 408, in test_generation_kwargs_validation
    |     assert any("temperature" in issue.lower() for issue in issues)
    | AssertionError: assert False
    |  +  where False = any(<generator object TestTaskConfigurationProperties.test_generation_kwargs_validation.<locals>.<genexpr> at 0x10bcc0e10>)
    | Falsifying example: test_generation_kwargs_validation(
    |     self=<Tests.Evals.test_eval_properties.TestTaskConfigurationProperties object at 0x10b8b7620>,
    |     generation_kwargs={'temperature': -1.0},
    | )
    +------------------------------------
----------------------------------------

124. Tests/Evals/test_eval_properties.py::TestFileHandlingProperties::test_text_processing_robustness: Tests/Evals/test_eval_properties.py:464: in test_text_processing_robustness
    @settings(max_examples=20, deadline=None)
               ^^^^^^^
Tests/Evals/test_eval_properties.py:467: in test_text_processing_robustness
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
E   Falsifying example: test_text_processing_robustness(
E       self=<Tests.Evals.test_eval_properties.TestFileHandlingProperties object at 0x10b89b230>,
E       text_input='0',  # or any other generated value
E   )
----------------------------------------

125. Tests/Evals/test_eval_properties.py::TestConcurrencyProperties::test_concurrent_task_creation_uniqueness: No details available
----------------------------------------

126. Tests/Evals/test_eval_properties.py::TestConcurrencyProperties::test_evaluation_order_independence: Tests/Evals/test_eval_properties.py:533: in test_evaluation_order_independence
    @settings(max_examples=5, deadline=None)
               ^^^^^^^
Tests/Evals/test_eval_properties.py:552: in test_evaluation_order_independence
    runner = EvalRunner(llm_interface=mock_llm)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
E   Falsifying example: test_evaluation_order_independence(
E       self=<Tests.Evals.test_eval_properties.TestConcurrencyProperties object at 0x10b8e50a0>,
E       samples=[{'id': '0',
E         'question': '0',
E         'answer': '',
E         'category': 'math',
E         'difficulty': 'easy'}],
E   )
----------------------------------------

127. Tests/Evals/test_eval_properties.py::TestSystemInvariants::test_resource_cleanup_invariant: No details available
----------------------------------------

128. Tests/Evals/test_eval_properties.py::TestSystemInvariants::test_database_consistency_invariant: No details available
----------------------------------------

129. Tests/Evals/test_eval_runner.py::TestEvalSampleResult::test_eval_result_with_error: Tests/Evals/test_eval_runner.py:47: in test_eval_result_with_error
    result = EvalSampleResult(
E   TypeError: EvalSampleResult.__init__() got an unexpected keyword argument 'error'
----------------------------------------

130. Tests/Evals/test_eval_runner.py::TestEvalProgress::test_eval_progress_creation: Tests/Evals/test_eval_runner.py:66: in test_eval_progress_creation
    progress = EvalProgress(
E   TypeError: EvalProgress.__init__() got an unexpected keyword argument 'total_samples'
----------------------------------------

131. Tests/Evals/test_eval_runner.py::TestEvalProgress::test_progress_percentage: Tests/Evals/test_eval_runner.py:80: in test_progress_percentage
    progress = EvalProgress(
E   TypeError: EvalProgress.__init__() got an unexpected keyword argument 'total_samples'
----------------------------------------

132. Tests/Evals/test_eval_runner.py::TestEvalProgress::test_estimated_time_remaining: Tests/Evals/test_eval_runner.py:95: in test_estimated_time_remaining
    progress = EvalProgress(
E   TypeError: EvalProgress.__init__() got an unexpected keyword argument 'total_samples'
----------------------------------------

133. Tests/Evals/test_eval_runner.py::TestEvalRunnerInitialization::test_eval_runner_creation: Tests/Evals/test_eval_runner.py:111: in test_eval_runner_creation
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

134. Tests/Evals/test_eval_runner.py::TestEvalRunnerInitialization::test_eval_runner_with_config: Tests/Evals/test_eval_runner.py:119: in test_eval_runner_with_config
    runner = EvalRunner(
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

135. Tests/Evals/test_eval_runner.py::TestBasicEvaluation::test_run_single_sample: Tests/Evals/test_eval_runner.py:136: in test_run_single_sample
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

136. Tests/Evals/test_eval_runner.py::TestBasicEvaluation::test_run_multiple_samples: Tests/Evals/test_eval_runner.py:154: in test_run_multiple_samples
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

137. Tests/Evals/test_eval_runner.py::TestBasicEvaluation::test_run_with_progress_callback: Tests/Evals/test_eval_runner.py:173: in test_run_with_progress_callback
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

138. Tests/Evals/test_eval_runner.py::TestDifferentTaskTypes::test_question_answer_task: Tests/Evals/test_eval_runner.py:210: in test_question_answer_task
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

139. Tests/Evals/test_eval_runner.py::TestDifferentTaskTypes::test_multiple_choice_task: Tests/Evals/test_eval_runner.py:237: in test_multiple_choice_task
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

140. Tests/Evals/test_eval_runner.py::TestDifferentTaskTypes::test_text_generation_task: Tests/Evals/test_eval_runner.py:265: in test_text_generation_task
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

141. Tests/Evals/test_eval_runner.py::TestDifferentTaskTypes::test_code_generation_task: Tests/Evals/test_eval_runner.py:293: in test_code_generation_task
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

142. Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_exact_match_metric: Tests/Evals/test_eval_runner.py:317: in test_exact_match_metric
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

143. Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_contains_answer_metric: Tests/Evals/test_eval_runner.py:333: in test_contains_answer_metric
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

144. Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_bleu_score_metric: Tests/Evals/test_eval_runner.py:349: in test_bleu_score_metric
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

145. Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_f1_score_metric: Tests/Evals/test_eval_runner.py:365: in test_f1_score_metric
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

146. Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_code_execution_metric: Tests/Evals/test_eval_runner.py:381: in test_code_execution_metric
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

147. Tests/Evals/test_eval_runner.py::TestMetricsCalculation::test_safety_metrics: Tests/Evals/test_eval_runner.py:399: in test_safety_metrics
    runner = EvalRunner(llm_interface=AsyncMock())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

148. Tests/Evals/test_eval_runner.py::TestErrorHandling::test_api_timeout_handling: Tests/Evals/test_eval_runner.py:417: in test_api_timeout_handling
    runner = EvalRunner(
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

149. Tests/Evals/test_eval_runner.py::TestErrorHandling::test_retry_mechanism: Tests/Evals/test_eval_runner.py:446: in test_retry_mechanism
    runner = EvalRunner(
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

150. Tests/Evals/test_eval_runner.py::TestErrorHandling::test_partial_failure_handling: Tests/Evals/test_eval_runner.py:476: in test_partial_failure_handling
    runner = EvalRunner(llm_interface=mock_llm)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

151. Tests/Evals/test_eval_runner.py::TestConcurrencyAndPerformance::test_concurrent_execution: Tests/Evals/test_eval_runner.py:513: in test_concurrent_execution
    runner = EvalRunner(
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

152. Tests/Evals/test_eval_runner.py::TestConcurrencyAndPerformance::test_memory_efficient_streaming: Tests/Evals/test_eval_runner.py:538: in test_memory_efficient_streaming
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

153. Tests/Evals/test_eval_runner.py::TestConcurrencyAndPerformance::test_cancellation_support: Tests/Evals/test_eval_runner.py:562: in test_cancellation_support
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

154. Tests/Evals/test_eval_runner.py::TestAdvancedFeatures::test_few_shot_prompting: Tests/Evals/test_eval_runner.py:597: in test_few_shot_prompting
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

155. Tests/Evals/test_eval_runner.py::TestAdvancedFeatures::test_custom_prompt_templates: Tests/Evals/test_eval_runner.py:628: in test_custom_prompt_templates
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

156. Tests/Evals/test_eval_runner.py::TestAdvancedFeatures::test_response_filtering: Tests/Evals/test_eval_runner.py:664: in test_response_filtering
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

157. Tests/Evals/test_eval_runner.py::TestSpecializedEvaluations::test_multilingual_evaluation: Tests/Evals/test_eval_runner.py:697: in test_multilingual_evaluation
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

158. Tests/Evals/test_eval_runner.py::TestSpecializedEvaluations::test_math_evaluation: Tests/Evals/test_eval_runner.py:736: in test_math_evaluation
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

159. Tests/Evals/test_eval_runner.py::TestSpecializedEvaluations::test_safety_evaluation: Tests/Evals/test_eval_runner.py:765: in test_safety_evaluation
    runner = EvalRunner(llm_interface=mock_llm_interface)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: EvalRunner.__init__() got an unexpected keyword argument 'llm_interface'
----------------------------------------

160. Tests/Evals/test_evals_db.py::TestDatasetOperations::test_get_dataset: Tests/Evals/test_evals_db.py:222: in test_get_dataset
    assert dataset['format'] == "local"
E   AssertionError: assert 'custom' == 'local'
E     
E     - local
E     + custom
----------------------------------------

161. Tests/Evals/test_evals_db.py::TestRunOperations::test_create_run: Tests/Evals/test_evals_db.py:286: in test_create_run
    run_id = in_memory_db.create_run(
E   TypeError: EvalsDB.create_run() got an unexpected keyword argument 'config'
----------------------------------------

162. Tests/Evals/test_evals_db.py::TestRunOperations::test_get_run: Tests/Evals/test_evals_db.py:306: in test_get_run
    run_id = in_memory_db.create_run(
E   TypeError: EvalsDB.create_run() got an unexpected keyword argument 'config'
----------------------------------------

163. Tests/Evals/test_evals_db.py::TestRunOperations::test_update_run_status: Tests/Evals/test_evals_db.py:327: in test_update_run_status
    run_id = in_memory_db.create_run(
E   TypeError: EvalsDB.create_run() got an unexpected keyword argument 'config'
----------------------------------------

164. Tests/Evals/test_evals_db.py::TestResultOperations::test_store_result: Tests/Evals/test_evals_db.py:353: in test_store_result
    run_id = in_memory_db.create_run(
E   TypeError: EvalsDB.create_run() got an unexpected keyword argument 'config'
----------------------------------------

165. Tests/Evals/test_evals_db.py::TestResultOperations::test_get_results_for_run: Tests/Evals/test_evals_db.py:381: in test_get_results_for_run
    run_id = in_memory_db.create_run(
E   TypeError: EvalsDB.create_run() got an unexpected keyword argument 'config'
----------------------------------------

166. Tests/Evals/test_evals_db.py::TestMetricsOperations::test_store_run_metrics: Tests/Evals/test_evals_db.py:419: in test_store_run_metrics
    run_id = in_memory_db.create_run(
E   TypeError: EvalsDB.create_run() got an unexpected keyword argument 'config'
----------------------------------------

167. Tests/Evals/test_evals_db.py::TestMetricsOperations::test_get_run_metrics: Tests/Evals/test_evals_db.py:450: in test_get_run_metrics
    run_id = in_memory_db.create_run(
E   TypeError: EvalsDB.create_run() got an unexpected keyword argument 'config'
----------------------------------------

168. Tests/Evals/test_evals_db.py::TestSearchOperations::test_search_datasets: Tests/Evals/test_evals_db.py:514: in test_search_datasets
    assert len(results) == 1
E   assert 0 == 1
E    +  where 0 = len([])
----------------------------------------

169. Tests/Evals/test_evals_db.py::TestErrorHandling::test_foreign_key_violation: Tests/Evals/test_evals_db.py:539: in test_foreign_key_violation
    in_memory_db.create_run(
E   TypeError: EvalsDB.create_run() got an unexpected keyword argument 'config'
----------------------------------------

170. Tests/Evals/test_evals_db.py::TestErrorHandling::test_concurrent_modification: Tests/Evals/test_evals_db.py:563: in test_concurrent_modification
    assert not success  # Should fail due to version mismatch
    ^^^^^^^^^^^^^^^^^^
E   assert not True
----------------------------------------

171. Tests/Evals/test_evals_db.py::TestThreadSafety::test_concurrent_read_write: Tests/Evals/test_evals_db.py:642: in test_concurrent_read_write
    assert len(write_results) == 5
E   assert 0 == 5
E    +  where 0 = len([])
----------------------------------------

172. Tests/Evals/test_task_loader.py::TestEleutherFormatLoading::test_load_eleuther_with_templates: Tests/Evals/test_task_loader.py:151: in test_load_eleuther_with_templates
    assert config.task_type == "generate_until"
E   AssertionError: assert 'generation' == 'generate_until'
E     
E     - generate_until
E     + generation
----------------------------------------

173. Tests/Evals/test_task_loader.py::TestEleutherFormatLoading::test_load_eleuther_complex_config: Tests/Evals/test_task_loader.py:189: in test_load_eleuther_complex_config
    assert "filter_list" in config.metadata
E   AssertionError: assert 'filter_list' in {'format': 'eleuther', 'original_config': {'dataset_name': 'gsm8k', 'fewshot_split': 'train', 'filter_list': [{'filter... 'regex_pattern': '####\\s*(\\d+)'}], 'generation_kwargs': {'max_tokens': 200, 'temperature': 0.0, 'top_p': 1.0}, ...}}
E    +  where {'format': 'eleuther', 'original_config': {'dataset_name': 'gsm8k', 'fewshot_split': 'train', 'filter_list': [{'filter... 'regex_pattern': '####\\s*(\\d+)'}], 'generation_kwargs': {'max_tokens': 200, 'temperature': 0.0, 'top_p': 1.0}, ...}} = TaskConfig(name='gsm8k_sample', description='Eleuther task: gsm8k_sample', task_type='generation', dataset_name='gsm8k...type': 'generate_until', 'task': 'gsm8k_sample', 'test_split': 'test', 'until': ['Q:', '\n\n']}, 'format': 'eleuther'}).metadata
----------------------------------------

174. Tests/Evals/test_task_loader.py::TestCustomFormatLoading::test_load_custom_with_fewshot: Tests/Evals/test_task_loader.py:248: in test_load_custom_with_fewshot
    assert config.metadata.get("fewshot_split") == "train"
E   AssertionError: assert None == 'train'
E    +  where None = <built-in method get of dict object at 0x10bd1b280>('fewshot_split')
E    +    where <built-in method get of dict object at 0x10bd1b280> = {'format': 'custom'}.get
E    +      where {'format': 'custom'} = TaskConfig(name='Few-shot Task', description='Task with few-shot examples', task_type='text_generation', dataset_name=...metric='bleu', filter_list=[], doc_to_text=None, doc_to_target=None, doc_to_choice=None, metadata={'format': 'custom'}).metadata
----------------------------------------

175. Tests/Evals/test_task_loader.py::TestHuggingFaceFormatLoading::test_load_huggingface_basic: /opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1393: in patched
    with self.decoration_helper(patched,
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1375: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1451: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'tldw_chatbook' has no attribute 'App_Functions'
----------------------------------------

176. Tests/Evals/test_task_loader.py::TestHuggingFaceFormatLoading::test_load_huggingface_with_config: /opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1393: in patched
    with self.decoration_helper(patched,
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1375: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1451: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'tldw_chatbook' has no attribute 'App_Functions'
----------------------------------------

177. Tests/Evals/test_task_loader.py::TestTaskValidation::test_validate_missing_required_fields: Tests/Evals/test_task_loader.py:483: in test_validate_missing_required_fields
    assert any("metric" in issue for issue in issues)
E   assert False
E    +  where False = any(<generator object TestTaskValidation.test_validate_missing_required_fields.<locals>.<genexpr> at 0x10bfdc450>)
----------------------------------------

178. Tests/Evals/test_task_loader.py::TestTaskValidation::test_validate_generation_kwargs: Tests/Evals/test_task_loader.py:521: in test_validate_generation_kwargs
    assert any("temperature" in issue for issue in issues)
E   assert False
E    +  where False = any(<generator object TestTaskValidation.test_validate_generation_kwargs.<locals>.<genexpr> at 0x10bfad080>)
----------------------------------------

179. Tests/Evals/test_task_loader.py::TestTaskValidation::test_validate_code_task_requirements: Tests/Evals/test_task_loader.py:540: in test_validate_code_task_requirements
    assert any("metric" in issue for issue in issues)
E   assert False
E    +  where False = any(<generator object TestTaskValidation.test_validate_code_task_requirements.<locals>.<genexpr> at 0x10bb95700>)
----------------------------------------

180. Tests/Evals/test_task_loader.py::TestErrorHandling::test_invalid_yaml_syntax: Tests/Evals/test_task_loader.py:565: in test_invalid_yaml_syntax
    loader.load_task(str(yaml_file), 'eleuther')
tldw_chatbook/Evals/task_loader.py:105: in load_task
    return self._load_eleuther_task(source)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Evals/task_loader.py:160: in _load_eleuther_task
    config_data = yaml.safe_load(f)
                  ^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/__init__.py:125: in safe_load
    return load(stream, SafeLoader)
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/__init__.py:81: in load
    return loader.get_single_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/constructor.py:49: in get_single_data
    node = self.get_single_node()
           ^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/composer.py:36: in get_single_node
    document = self.compose_document()
               ^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/composer.py:55: in compose_document
    node = self.compose_node(None, None)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/composer.py:84: in compose_node
    node = self.compose_mapping_node(anchor)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/composer.py:133: in compose_mapping_node
    item_value = self.compose_node(node, item_key)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/composer.py:82: in compose_node
    node = self.compose_sequence_node(anchor)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/composer.py:110: in compose_sequence_node
    while not self.check_event(SequenceEndEvent):
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/parser.py:98: in check_event
    self.current_event = self.state()
                         ^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/yaml/parser.py:483: in parse_flow_sequence_entry
    raise ParserError("while parsing a flow sequence", self.marks[-1],
E   yaml.parser.ParserError: while parsing a flow sequence
E     in "/private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-387/test_invalid_yaml_syntax0/invalid.yaml", line 3, column 23
E   expected ',' or ']', but got '<stream end>'
E     in "/private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-387/test_invalid_yaml_syntax0/invalid.yaml", line 4, column 9
----------------------------------------

181. Tests/Evals/test_task_loader.py::TestErrorHandling::test_invalid_json_syntax: Tests/Evals/test_task_loader.py:577: in test_invalid_json_syntax
    loader.load_task(str(json_file), 'custom')
tldw_chatbook/Evals/task_loader.py:107: in load_task
    return self._load_custom_task(source)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Evals/task_loader.py:256: in _load_custom_task
    config_data = json.load(f)
                  ^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/json/__init__.py:293: in load
    return loads(fp.read(),
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/json/__init__.py:346: in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/json/decoder.py:338: in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/homebrew/Cellar/python@3.12/3.12.11/Frameworks/Python.framework/Versions/3.12/lib/python3.12/json/decoder.py:356: in raw_decode
    raise JSONDecodeError("Expecting value", s, err.value) from None
E   json.decoder.JSONDecodeError: Expecting value: line 1 column 29 (char 28)
----------------------------------------

182. Tests/Evals/test_task_loader.py::TestFormatConversion::test_eleuther_to_custom_conversion: Tests/Evals/test_task_loader.py:631: in test_eleuther_to_custom_conversion
    custom_dict = loader.convert_to_custom_format(config)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute 'convert_to_custom_format'. Did you mean: '_convert_to_eleuther_format'?
----------------------------------------

183. Tests/Evals/test_task_loader.py::TestFormatConversion::test_custom_to_eleuther_conversion: Tests/Evals/test_task_loader.py:641: in test_custom_to_eleuther_conversion
    eleuther_dict = loader.convert_to_eleuther_format(sample_task_config)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute 'convert_to_eleuther_format'. Did you mean: '_convert_to_eleuther_format'?
----------------------------------------

184. Tests/Evals/test_task_loader.py::TestTaskTemplateGeneration::test_generate_basic_template: Tests/Evals/test_task_loader.py:654: in test_generate_basic_template
    template = loader.generate_template("question_answer")
               ^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute 'generate_template'
----------------------------------------

185. Tests/Evals/test_task_loader.py::TestTaskTemplateGeneration::test_generate_code_template: Tests/Evals/test_task_loader.py:665: in test_generate_code_template
    template = loader.generate_template("code_generation")
               ^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute 'generate_template'
----------------------------------------

186. Tests/Evals/test_task_loader.py::TestTaskTemplateGeneration::test_generate_eleuther_template: Tests/Evals/test_task_loader.py:675: in test_generate_eleuther_template
    template = loader.generate_eleuther_template("multiple_choice")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute 'generate_eleuther_template'
----------------------------------------

187. Tests/Evals/test_task_loader.py::TestUtilityFunctions::test_detect_file_format: Tests/Evals/test_task_loader.py:692: in test_detect_file_format
    assert loader._detect_file_format(str(yaml_file)) == "eleuther"
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute '_detect_file_format'. Did you mean: '_detect_format'?
----------------------------------------

188. Tests/Evals/test_task_loader.py::TestUtilityFunctions::test_normalize_task_type: Tests/Evals/test_task_loader.py:711: in test_normalize_task_type
    assert loader._normalize_task_type("multiple_choice") == "multiple_choice"
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute '_normalize_task_type'
----------------------------------------

189. Tests/Evals/test_task_loader.py::TestUtilityFunctions::test_validate_dataset_path: Tests/Evals/test_task_loader.py:721: in test_validate_dataset_path
    assert loader._validate_dataset_path("local_file.csv") == True
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute '_validate_dataset_path'
----------------------------------------

190. Tests/Evals/test_task_loader.py::TestUtilityFunctions::test_merge_generation_kwargs: Tests/Evals/test_task_loader.py:735: in test_merge_generation_kwargs
    merged = loader._merge_generation_kwargs(defaults, overrides)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'TaskLoader' object has no attribute '_merge_generation_kwargs'
----------------------------------------

================================================================================

Directory: Widgets
Duration: 2.31s
Passed: 23, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: UI
Duration: 4.68s
Passed: 0, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: integration
Duration: 5.13s
Passed: 24, Failed: 5, Skipped: 0, Errors: 12

Failures:

1. ==================================== ERRORS ====================================
----------------------------------------

2. ___ ERROR at setup of TestChatImageIntegration.test_attach_image_button_flow ___
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,336 [DEBUG] asyncio:64 - Using selector: KqueueSelector
2025-06-28 21:12:28,336 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

3. 2025-06-28 21:12:28,337 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

4. 2025-06-28 21:12:28,337 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

5. 2025-06-28 21:12:28,337 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.340 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.340 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.340 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.340 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.340 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.341 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.342 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.343 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.343 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.343 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,343 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,343 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.343 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

6. 2025-06-28 21:12:28,343 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

7. 2025-06-28 21:12:28,343 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,343 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.343 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.343 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.343 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.343 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.343 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.345 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.345 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,346 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,346 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.346 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.346 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.346 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.346 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.346 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.346 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.346 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.346 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,346 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,346 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,346 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,346 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,346 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,346 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,347 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.347 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x16581a630>
2025-06-28 21:12:28.347 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.347 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,347 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

8. 2025-06-28 21:12:28,347 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

9. 2025-06-28 21:12:28,347 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.347 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.347 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,347 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,347 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

10. 2025-06-28 21:12:28,347 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.010 seconds
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.003s (27.0%)
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.3%)
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.003s (25.6%)
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (4.5%)
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.001s (5.2%)
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

11. 2025-06-28 21:12:28,347 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

12. 2025-06-28 21:12:28,347 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.347 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_attach_image_button_flow0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.347 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_attach_image_button_flow0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.348 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.348 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.348 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_attach_image_button_flow0/db/chachanotes.db...
2025-06-28 21:12:28.354 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.354 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_attach_image_button_flow0/db/chachanotes.db.
2025-06-28 21:12:28.354 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_attach_image_button_flow0/db/chachanotes.db...
2025-06-28 21:12:28.359 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.359 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_attach_image_button_flow0/db/chachanotes.db.
2025-06-28 21:12:28.359 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.359 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.359 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_attach_image_button_flow0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

13. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

14. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

15. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

16. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

17. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

18. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

19. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

20. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

21. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

22. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

23. _ ERROR at setup of TestChatImageIntegration.test_image_path_submission_success _
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,363 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

24. 2025-06-28 21:12:28,363 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

25. 2025-06-28 21:12:28,364 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

26. 2025-06-28 21:12:28,364 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.364 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.364 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.364 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.364 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.364 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.365 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.366 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.366 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.366 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.366 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,366 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,366 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.366 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

27. 2025-06-28 21:12:28,366 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

28. 2025-06-28 21:12:28,366 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,366 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.366 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.366 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.366 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.366 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.367 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.368 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.369 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,369 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,369 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.369 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:12:28.369 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.369 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.369 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.369 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.369 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.369 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.369 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.369 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,369 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,369 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,369 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,369 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,369 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,369 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,369 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.369 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.369 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x16587e2a0>
2025-06-28 21:12:28.369 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.369 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,369 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

29. 2025-06-28 21:12:28,370 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

30. 2025-06-28 21:12:28,370 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.370 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.370 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,370 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,370 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

31. 2025-06-28 21:12:28,370 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.9%)
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.3%)
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (3.1%)
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (36.8%)
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.5%)
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.7%)
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

32. 2025-06-28 21:12:28,370 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

33. 2025-06-28 21:12:28,370 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_suc0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.370 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_suc0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.370 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.370 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_suc0/db/chachanotes.db...
2025-06-28 21:12:28.376 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.376 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_suc0/db/chachanotes.db.
2025-06-28 21:12:28.376 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_suc0/db/chachanotes.db...
2025-06-28 21:12:28.381 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.381 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_suc0/db/chachanotes.db.
2025-06-28 21:12:28.381 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.381 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.381 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_suc0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

34. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

35. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

36. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

37. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

38. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

39. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

40. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

41. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

42. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

43. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

44. _ ERROR at setup of TestChatImageIntegration.test_image_path_submission_invalid_file _
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,387 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

45. 2025-06-28 21:12:28,387 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

46. 2025-06-28 21:12:28,387 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

47. 2025-06-28 21:12:28,387 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.388 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.388 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.388 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.388 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.388 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.389 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,390 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,390 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

48. 2025-06-28 21:12:28,390 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

49. 2025-06-28 21:12:28,390 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,390 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.390 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.390 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.391 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.392 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,392 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,392 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.392 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:12:28.392 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.392 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.393 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.393 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,393 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,393 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,393 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,393 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,393 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,393 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,393 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.393 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x1657bd6a0>
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,393 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.393 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.393 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

50. 2025-06-28 21:12:28,393 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

51. 2025-06-28 21:12:28,393 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.393 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,393 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,393 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

52. 2025-06-28 21:12:28,394 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (34.6%)
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.7%)
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (35.9%)
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (7.1%)
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.001s (8.5%)
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

53. 2025-06-28 21:12:28,394 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

54. 2025-06-28 21:12:28,394 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_inv0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.394 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_inv0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.394 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.394 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_inv0/db/chachanotes.db...
2025-06-28 21:12:28.400 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.400 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_inv0/db/chachanotes.db.
2025-06-28 21:12:28.400 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_inv0/db/chachanotes.db...
2025-06-28 21:12:28.405 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.405 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_inv0/db/chachanotes.db.
2025-06-28 21:12:28.405 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.405 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.405 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_path_submission_inv0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

55. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

56. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

57. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

58. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

59. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

60. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

61. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

62. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

63. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

64. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

65. ____ ERROR at setup of TestChatImageIntegration.test_clear_image_attachment ____
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,409 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

66. 2025-06-28 21:12:28,409 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

67. 2025-06-28 21:12:28,409 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

68. 2025-06-28 21:12:28,409 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.410 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.410 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.410 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.410 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.410 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.411 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,412 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,412 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

69. 2025-06-28 21:12:28,412 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

70. 2025-06-28 21:12:28,412 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,412 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.412 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.412 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.414 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.414 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,414 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,414 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.415 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:12:28.415 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.415 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.415 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.415 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,415 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,415 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,415 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,415 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,415 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,415 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,415 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.415 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x16583b530>
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,415 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.415 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.415 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

71. 2025-06-28 21:12:28,415 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

72. 2025-06-28 21:12:28,415 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.415 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,415 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,415 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

73. 2025-06-28 21:12:28,416 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.6%)
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.3%)
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.9%)
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (35.4%)
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (6.0%)
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.001s (7.9%)
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

74. 2025-06-28 21:12:28,416 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

75. 2025-06-28 21:12:28,416 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_clear_image_attachment0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.416 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_clear_image_attachment0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.416 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.416 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_clear_image_attachment0/db/chachanotes.db...
2025-06-28 21:12:28.422 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.422 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_clear_image_attachment0/db/chachanotes.db.
2025-06-28 21:12:28.422 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_clear_image_attachment0/db/chachanotes.db...
2025-06-28 21:12:28.427 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.427 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_clear_image_attachment0/db/chachanotes.db.
2025-06-28 21:12:28.427 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.427 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.427 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_clear_image_attachment0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

76. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

77. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

78. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

79. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

80. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

81. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

82. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

83. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

84. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

85. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

86. ___ ERROR at setup of TestChatImageIntegration.test_send_message_with_image ____
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,431 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

87. 2025-06-28 21:12:28,432 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

88. 2025-06-28 21:12:28,432 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

89. 2025-06-28 21:12:28,432 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.432 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.432 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.432 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.432 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.432 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.434 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.434 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.435 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.435 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.435 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,435 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,435 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.435 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

90. 2025-06-28 21:12:28,435 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

91. 2025-06-28 21:12:28,435 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,435 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.435 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.435 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.435 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.435 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.435 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.436 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.437 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,437 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,437 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.437 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:12:28.437 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.437 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.437 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.437 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.437 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.437 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.438 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,438 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,438 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,438 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,438 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,438 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,438 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,438 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.438 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x165843380>
2025-06-28 21:12:28.438 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.438 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,438 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

92. 2025-06-28 21:12:28,438 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

93. 2025-06-28 21:12:28,438 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.438 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.438 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,438 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,438 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

94. 2025-06-28 21:12:28,438 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.8%)
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.3%)
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (3.0%)
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (35.0%)
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (6.0%)
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.5%)
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

95. 2025-06-28 21:12:28,438 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

96. 2025-06-28 21:12:28,438 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.438 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_send_message_with_image0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.439 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_send_message_with_image0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.439 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.439 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.439 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_send_message_with_image0/db/chachanotes.db...
2025-06-28 21:12:28.445 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.445 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_send_message_with_image0/db/chachanotes.db.
2025-06-28 21:12:28.445 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_send_message_with_image0/db/chachanotes.db...
2025-06-28 21:12:28.450 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.450 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_send_message_with_image0/db/chachanotes.db.
2025-06-28 21:12:28.450 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.450 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.450 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_send_message_with_image0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

97. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

98. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

99. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

100. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

101. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

102. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

103. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

104. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

105. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

106. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

107. ________ ERROR at setup of TestChatImageIntegration.test_image_resizing ________
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,454 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

108. 2025-06-28 21:12:28,454 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

109. 2025-06-28 21:12:28,454 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

110. 2025-06-28 21:12:28,454 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.454 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.454 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.454 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.454 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.454 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.456 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.456 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.457 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.457 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.457 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,457 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,457 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.457 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

111. 2025-06-28 21:12:28,457 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

112. 2025-06-28 21:12:28,457 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,457 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.457 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.457 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.457 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.457 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.457 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.458 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.459 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,459 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,459 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.459 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:12:28.459 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.459 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.459 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.459 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.459 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.459 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.459 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.459 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,459 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,459 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,460 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,460 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,460 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,460 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,460 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.460 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x1658f7fe0>
2025-06-28 21:12:28.460 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.460 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,460 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

113. 2025-06-28 21:12:28,460 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

114. 2025-06-28 21:12:28,460 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.460 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.460 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,460 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,460 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

115. 2025-06-28 21:12:28,460 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.5%)
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.3%)
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.9%)
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (36.5%)
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.9%)
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.9%)
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

116. 2025-06-28 21:12:28,460 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

117. 2025-06-28 21:12:28,460 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.460 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_resizing0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.461 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_resizing0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.461 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.461 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.461 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_resizing0/db/chachanotes.db...
2025-06-28 21:12:28.466 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.466 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_resizing0/db/chachanotes.db.
2025-06-28 21:12:28.466 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_resizing0/db/chachanotes.db...
2025-06-28 21:12:28.471 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.471 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_resizing0/db/chachanotes.db.
2025-06-28 21:12:28.471 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.471 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.471 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_resizing0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

118. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

119. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

120. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

121. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

122. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

123. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

124. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

125. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

126. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

127. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

128. ____ ERROR at setup of TestChatImageIntegration.test_unsupported_file_type _____
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,475 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

129. 2025-06-28 21:12:28,475 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

130. 2025-06-28 21:12:28,475 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

131. 2025-06-28 21:12:28,475 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.475 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.475 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.475 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.475 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.475 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.477 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.477 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.477 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.478 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.478 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,478 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,478 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.478 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

132. 2025-06-28 21:12:28,478 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

133. 2025-06-28 21:12:28,478 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,478 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.478 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.478 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.478 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.478 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.478 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.479 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.480 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,480 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,480 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.480 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:12:28.480 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.480 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.480 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.480 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.480 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.480 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.480 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.480 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,480 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,480 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,481 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,481 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,481 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,481 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,481 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.481 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x1658b5b50>
2025-06-28 21:12:28.481 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.481 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,481 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

134. 2025-06-28 21:12:28,481 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

135. 2025-06-28 21:12:28,481 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.481 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.481 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,481 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,481 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

136. 2025-06-28 21:12:28,481 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (36.0%)
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.3%)
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (3.0%)
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (37.0%)
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.7%)
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.8%)
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

137. 2025-06-28 21:12:28,481 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

138. 2025-06-28 21:12:28,481 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.481 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_unsupported_file_type0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.481 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_unsupported_file_type0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.482 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.482 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.482 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_unsupported_file_type0/db/chachanotes.db...
2025-06-28 21:12:28.487 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.488 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_unsupported_file_type0/db/chachanotes.db.
2025-06-28 21:12:28.488 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_unsupported_file_type0/db/chachanotes.db...
2025-06-28 21:12:28.492 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.492 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_unsupported_file_type0/db/chachanotes.db.
2025-06-28 21:12:28.492 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.492 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.492 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_unsupported_file_type0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

139. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

140. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

141. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

142. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

143. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

144. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

145. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

146. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

147. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

148. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

149. ____ ERROR at setup of TestChatImageIntegration.test_image_preview_display _____
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,496 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

150. 2025-06-28 21:12:28,496 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

151. 2025-06-28 21:12:28,496 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

152. 2025-06-28 21:12:28,496 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.497 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.497 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.497 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.497 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.497 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.498 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,499 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,499 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

153. 2025-06-28 21:12:28,499 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

154. 2025-06-28 21:12:28,499 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,499 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.499 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.499 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.500 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.501 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,501 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,501 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.501 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:12:28.501 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.501 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.501 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.502 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.502 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.502 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,502 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,502 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,502 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,502 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,502 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,502 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,502 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.502 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x165942510>
2025-06-28 21:12:28.502 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.502 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,502 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

155. 2025-06-28 21:12:28,502 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

156. 2025-06-28 21:12:28,502 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.502 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.502 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,502 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,502 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

157. 2025-06-28 21:12:28,502 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.7%)
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.3%)
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (3.0%)
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (37.4%)
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.8%)
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.8%)
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

158. 2025-06-28 21:12:28,502 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

159. 2025-06-28 21:12:28,502 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.502 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_preview_display0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.503 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_preview_display0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.503 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.503 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.503 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_preview_display0/db/chachanotes.db...
2025-06-28 21:12:28.509 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.509 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_preview_display0/db/chachanotes.db.
2025-06-28 21:12:28.509 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_preview_display0/db/chachanotes.db...
2025-06-28 21:12:28.514 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.514 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_preview_display0/db/chachanotes.db.
2025-06-28 21:12:28.514 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.514 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.514 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_image_preview_display0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

160. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

161. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

162. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

163. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

164. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

165. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

166. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

167. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

168. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

169. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

170. _ ERROR at setup of TestChatImageIntegration.test_multiple_image_attachments_not_allowed _
Tests/integration/test_chat_image_integration_real.py:86: in real_app_with_image_support
    app.media_db = MediaDatabase(str(db_dir / "media.db"))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: MediaDatabase.__init__() missing 1 required positional argument: 'client_id'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28,523 [DEBUG] asyncio:64 - Using selector: KqueueSelector
----------------------------------------

171. 2025-06-28 21:12:28,524 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

172. 2025-06-28 21:12:28,524 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

173. 2025-06-28 21:12:28,524 [ERROR] root:85 - Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
2025-06-28 21:12:28.524 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.524 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.524 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.524 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.524 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.525 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.app:__init__:973 - Unified ChaChaNotes DB file path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.app:__init__:980 - Notes for user 'default_user' will use the unified DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.app:__init__:981 - Base directory to be passed to NotesInteropService: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,526 [INFO] tldw_chatbook.Notes.Notes_Library:46 - NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
2025-06-28 21:12:28,526 [INFO] tldw_chatbook.Notes.Notes_Library:54 - NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.app:__init__:990 - NotesInteropService successfully initialized for user 'default_user'.
----------------------------------------

174. 2025-06-28 21:12:28,526 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

175. 2025-06-28 21:12:28,526 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28,526 [DEBUG] root:1007 - __INIT__: Attempting to get providers and models...
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.config:load_settings:207 - Determined ACTUAL_PROJECT_ROOT for general paths: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.config:load_settings:208 - Determined APP_COMPONENT_ROOT for config files: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.config:load_settings:217 - Attempting to load primary TOML config from: /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml
2025-06-28 21:12:28.526 | WARNING  | tldw_chatbook.config:load_settings:223 - Primary TOML Config file not found at /Users/appledev/Working/tldw_chatbook_dev/tldw_chatbook/Config_Files/config.toml. Proceeding without it.
2025-06-28 21:12:28.526 | INFO     | tldw_chatbook.config:load_settings:232 - Attempting to load user-specific CLI TOML config for overrides from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.528 | INFO     | tldw_chatbook.config:load_settings:237 - Successfully loaded user-specific CLI TOML config from: /Users/appledev/.config/tldw_cli/config.toml
2025-06-28 21:12:28.529 | INFO     | tldw_chatbook.config:load_settings:252 - Merged all configurations: CLI Defaults < Primary Config < User CLI Config.
2025-06-28 21:12:28,529 [INFO] root:1011 - __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
2025-06-28 21:12:28,529 [INFO] root:1026 - App __init__: Determined initial tab value: chat
2025-06-28 21:12:28.529 | WARNING  | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:92 - Prompts interop library already initialized with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db'. Re-initializing with DB: '/Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db', Client ID: 'tldw_tui_client_v1'.
2025-06-28 21:12:28.529 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:105 - Initializing Prompts Interop Library. DB Path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db, Client ID: tldw_tui_client_v1
2025-06-28 21:12:28.529 | INFO     | tldw_chatbook.DB.Prompts_DB:__init__:251 - Initializing PromptsDatabase object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client ID: tldw_tui_client_v1]
2025-06-28 21:12:28.529 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_get_thread_connection:317 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db [Client: tldw_tui_client_v1, Thread: MainThread]
2025-06-28 21:12:28.529 | INFO     | tldw_chatbook.DB.Prompts_DB:_initialize_schema:518 - Checking DB schema. Current: 1, Code supports: 1
2025-06-28 21:12:28.529 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:521 - Database schema is up to date.
2025-06-28 21:12:28.529 | DEBUG    | tldw_chatbook.DB.Prompts_DB:_initialize_schema:525 - Verified FTS tables exist.
2025-06-28 21:12:28.529 | DEBUG    | tldw_chatbook.DB.Prompts_DB:__init__:281 - PromptsDatabase initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28.529 | INFO     | tldw_chatbook.Prompt_Management.Prompts_Interop:initialize_interop:110 - Prompts Interop Library initialized successfully.
2025-06-28 21:12:28,529 [INFO] root:1040 - Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
2025-06-28 21:12:28,529 [INFO] root:444 - Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
2025-06-28 21:12:28,529 [DEBUG] root:510 - Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
2025-06-28 21:12:28,529 [INFO] root:747 - Checking DB schema. Current version: 1. Code supports: 1
2025-06-28 21:12:28,529 [DEBUG] root:750 - Database schema is up to date.
2025-06-28 21:12:28,529 [DEBUG] root:755 - Verified FTS tables exist.
2025-06-28 21:12:28,529 [DEBUG] root:474 - Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.529 | INFO     | tldw_chatbook.app:__init__:1057 - Media_DB_v2 initialized successfully for client 'tldw_cli_local_instance_v1' at /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.529 | DEBUG    | tldw_chatbook.app:__init__:1059 - ULTRA EARLY APP INIT: self.media_db instance: <tldw_chatbook.DB.Client_Media_DB_v2.MediaDatabase object at 0x1658f7f80>
2025-06-28 21:12:28.529 | DEBUG    | tldw_chatbook.app:__init__:1061 - ULTRA EARLY APP INIT: self.media_db.db_path_str: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
2025-06-28 21:12:28.529 | DEBUG    | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3417 - Fetching distinct media types from DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db (deleted=False, trash=False)
2025-06-28 21:12:28,529 [DEBUG] root:565 - Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
2025-06-28 21:12:28.529 | INFO     | tldw_chatbook.DB.Client_Media_DB_v2:get_distinct_media_types:3431 - Found 3 distinct media types: ['article', 'podcast', 'video']
2025-06-28 21:12:28.529 | INFO     | tldw_chatbook.app:__init__:1075 - App __init__: Pre-fetched 4 media types for UI.
----------------------------------------

176. 2025-06-28 21:12:28,529 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

177. 2025-06-28 21:12:28,530 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.530 | DEBUG    | tldw_chatbook.app:__init__:1089 - ULTRA EARLY APP INIT: self._media_types_for_ui VALUE: ['All Media', 'article', 'podcast', 'video']
2025-06-28 21:12:28.530 | DEBUG    | tldw_chatbook.app:__init__:1090 - ULTRA EARLY APP INIT: self._media_types_for_ui TYPE: <class 'list'>
2025-06-28 21:12:28,530 [INFO] root:1104 - Assigned prompts_interop.get_db_instance() to self.prompts_db
2025-06-28 21:12:28,530 [INFO] root:1117 - Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

178. 2025-06-28 21:12:28,530 [ERROR] root:99 - Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1133 - === STARTUP TIMING SUMMARY ===
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1134 - Total initialization time: 0.006 seconds
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1138 -   basic_init: 0.002s (35.8%)
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1138 -   attribute_init: 0.000s (0.2%)
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1138 -   notes_service_init: 0.000s (2.7%)
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1138 -   providers_models: 0.002s (37.5%)
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1138 -   prompts_service_init: 0.000s (5.7%)
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1138 -   media_db_init: 0.000s (7.6%)
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.app:__init__:1139 - ==============================
----------------------------------------

179. 2025-06-28 21:12:28,530 [ERROR] root:114 - Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

180. 2025-06-28 21:12:28,530 [ERROR] root:114 - Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_multiple_image_attachment0/db/chachanotes.db [Client ID: test_user]
2025-06-28 21:12:28.530 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_multiple_image_attachment0/db/chachanotes.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.530 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.530 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_multiple_image_attachment0/db/chachanotes.db...
2025-06-28 21:12:28.536 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.536 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_multiple_image_attachment0/db/chachanotes.db.
2025-06-28 21:12:28.536 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_multiple_image_attachment0/db/chachanotes.db...
2025-06-28 21:12:28.541 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.541 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_multiple_image_attachment0/db/chachanotes.db.
2025-06-28 21:12:28.541 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.541 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.541 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/pytest-of-appledev/pytest-389/test_multiple_image_attachment0/db/chachanotes.db
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: KqueueSelector
----------------------------------------

181. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

182. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

183. ERROR    root:metrics.py:85 Failed to log counter app_startup_initiated: No label names were set when constructing counter:app_startup_initiated
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:46 NotesInteropService: Ensured base directory exists: /Users/appledev/.local/share/tldw_cli/default_user
INFO     tldw_chatbook.Notes.Notes_Library:Notes_Library.py:54 NotesInteropService initialized with unified DB template: /Users/appledev/.local/share/tldw_cli/default_user/tldw_chatbook_ChaChaNotes.db
----------------------------------------

184. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

185. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
DEBUG    root:app.py:1007 __INIT__: Attempting to get providers and models...
INFO     root:app.py:1011 __INIT__: Successfully retrieved providers_models. Count: 26. Keys: ['OpenAI', 'Anthropic', 'Cohere', 'DeepSeek', 'Groq', 'Google', 'HuggingFace', 'MistralAI', 'OpenRouter', 'Llama_cpp', 'koboldcpp', 'Oobabooga', 'Ollama', 'vLLM', 'Custom', 'Custom_2', 'TabbyAPI', 'Aphrodite', 'local-llm', 'local_llamacpp', 'local_llamafile', 'local_ollama', 'local_vllm', 'local_onnx', 'local_transformers', 'local_mlx_lm']
INFO     root:app.py:1026 App __init__: Determined initial tab value: chat
INFO     root:app.py:1040 Prompts Interop Service initialized with DB: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_prompts.db
INFO     root:Client_Media_DB_v2.py:444 Initializing Database object for path: /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client ID: tldw_cli_local_instance_v1]
DEBUG    root:Client_Media_DB_v2.py:510 Opened/Reopened SQLite connection to /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db [Client: tldw_cli_local_instance_v1, Thread: MainThread]
INFO     root:Client_Media_DB_v2.py:747 Checking DB schema. Current version: 1. Code supports: 1
DEBUG    root:Client_Media_DB_v2.py:750 Database schema is up to date.
DEBUG    root:Client_Media_DB_v2.py:755 Verified FTS tables exist.
DEBUG    root:Client_Media_DB_v2.py:474 Database initialization completed successfully for /Users/appledev/.local/share/tldw_cli/default_user/tldw_cli_media_v2.db
DEBUG    root:Client_Media_DB_v2.py:565 Executing Query: SELECT DISTINCT type FROM Media WHERE type IS NOT NULL AND type != '' AND deleted = 0 AND is_trash = 0 ORDER BY type ASC... Params: None...
----------------------------------------

186. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

187. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
INFO     root:app.py:1104 Assigned prompts_interop.get_db_instance() to self.prompts_db
INFO     root:app.py:1117 Assigned global_db_instance to self.chachanotes_db as fallback.
----------------------------------------

188. ERROR    root:metrics.py:99 Failed to log histogram app_startup_total_duration_seconds: No label names were set when constructing histogram:app_startup_total_duration_seconds
----------------------------------------

189. ERROR    root:metrics.py:114 Failed to log gauge process_memory_mb: No label names were set when constructing gauge:process_memory_mb
----------------------------------------

190. ERROR    root:metrics.py:114 Failed to log gauge process_cpu_percent: No label names were set when constructing gauge:process_cpu_percent
----------------------------------------

191. _ ERROR at setup of TestFileOperationErrorHandling.test_prepare_files_with_missing_files _
file /Users/appledev/Working/tldw_chatbook_dev/Tests/integration/test_file_operations_with_validation.py, line 241
      def test_prepare_files_with_missing_files(self, temp_upload_dir):
E       fixture 'temp_upload_dir' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, include_metadata_in_junit_xml, json_metadata, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

192. _ ERROR at setup of TestFileOperationErrorHandling.test_prepare_files_error_recovery _
file /Users/appledev/Working/tldw_chatbook_dev/Tests/integration/test_file_operations_with_validation.py, line 257
      def test_prepare_files_error_recovery(self, temp_upload_dir):
E       fixture 'temp_upload_dir' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, include_metadata_in_junit_xml, json_metadata, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

193. _ ERROR at setup of TestFileOperationErrorHandling.test_hidden_file_validation _
file /Users/appledev/Working/tldw_chatbook_dev/Tests/integration/test_file_operations_with_validation.py, line 278
      def test_hidden_file_validation(self, temp_upload_dir):
E       fixture 'temp_upload_dir' not found
>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, class_mocker, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, include_metadata_in_junit_xml, json_metadata, metadata, mocker, module_mocker, monkeypatch, package_mocker, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, session_mocker, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.
----------------------------------------

194. 2025-06-28 21:12:28.722 | ERROR    | tldw_chatbook.Character_Chat.Character_Chat_Lib:load_chat_history_from_file_and_save_to_db:1908 - Character 'TestCharacter' from chat log '/private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpufwsxm4f/chat_history.json' not found in the database.
___ TestCharacterChatFileOperations.test_load_chat_history_with_invalid_path ___
Tests/integration/test_file_operations_with_validation.py:83: in test_load_chat_history_with_invalid_path
    with pytest.raises(ValueError, match="outside the allowed directory"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   Failed: DID NOT RAISE <class 'ValueError'>
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28.726 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp8_bjypff/test.db [Client ID: test_client]
2025-06-28 21:12:28.726 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp8_bjypff/test.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.726 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.726 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.726 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp8_bjypff/test.db...
2025-06-28 21:12:28.732 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.732 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp8_bjypff/test.db.
2025-06-28 21:12:28.732 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp8_bjypff/test.db...
2025-06-28 21:12:28.737 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.737 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp8_bjypff/test.db.
2025-06-28 21:12:28.737 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.737 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.737 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp8_bjypff/test.db
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:28.737 | WARNING  | tldw_chatbook.Utils.path_validation:validate_path:43 - Path traversal attempt detected: /var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpeuqf5yww.json -> /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpeuqf5yww.json
----------------------------------------

195. 2025-06-28 21:12:28.738 | ERROR    | tldw_chatbook.Utils.path_validation:validate_path:54 - Path validation error for '/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpeuqf5yww.json': Path '/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpeuqf5yww.json' is outside the allowed directory
----------------------------------------

196. 2025-06-28 21:12:28.738 | ERROR    | tldw_chatbook.Character_Chat.Character_Chat_Lib:load_chat_history_from_file_and_save_to_db:1845 - Invalid chat history file path '/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpeuqf5yww.json': Path '/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpeuqf5yww.json' is outside the allowed directory
__ TestCharacterChatFileOperations.test_load_chat_history_with_path_traversal __
Tests/integration/test_file_operations_with_validation.py:97: in test_load_chat_history_with_path_traversal
    with pytest.raises(ValueError, match="outside the allowed directory"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   Failed: DID NOT RAISE <class 'ValueError'>
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28.740 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpybx0la02/test.db [Client ID: test_client]
2025-06-28 21:12:28.741 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpybx0la02/test.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.741 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.741 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.741 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpybx0la02/test.db...
2025-06-28 21:12:28.747 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.747 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpybx0la02/test.db.
2025-06-28 21:12:28.747 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpybx0la02/test.db...
2025-06-28 21:12:28.752 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.752 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpybx0la02/test.db.
2025-06-28 21:12:28.752 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.752 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.752 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpybx0la02/test.db
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:28.753 | WARNING  | tldw_chatbook.Utils.path_validation:validate_path:43 - Path traversal attempt detected: ../../../etc/passwd -> /private/var/folders/qc/etc/passwd
----------------------------------------

197. 2025-06-28 21:12:28.753 | ERROR    | tldw_chatbook.Utils.path_validation:validate_path:54 - Path validation error for '../../../etc/passwd': Path '../../../etc/passwd' is outside the allowed directory
----------------------------------------

198. 2025-06-28 21:12:28.753 | ERROR    | tldw_chatbook.Character_Chat.Character_Chat_Lib:load_chat_history_from_file_and_save_to_db:1845 - Invalid chat history file path '../../../etc/passwd': Path '../../../etc/passwd' is outside the allowed directory
___ TestCharacterChatFileOperations.test_load_chat_history_from_file_object ____
Tests/integration/test_file_operations_with_validation.py:120: in test_load_chat_history_from_file_object
    assert conv_id == "conv_123"
E   AssertionError: assert None == 'conv_123'
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:28.755 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:__init__:992 - Initializing CharactersRAGDB for path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpbnyv97_p/test.db [Client ID: test_client]
2025-06-28 21:12:28.756 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_get_thread_connection:1051 - Opened/Reopened SQLite connection to /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpbnyv97_p/test.db (Journal: wal) for thread 8705548032
2025-06-28 21:12:28.756 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__enter__:4087 - Transaction started (outermost) on thread 8705548032.
2025-06-28 21:12:28.756 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1403 - Checking DB schema 'rag_char_chat_schema'. Current version: 0. Code supports: 5
2025-06-28 21:12:28.756 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1322 - Applying schema Version 4 for 'rag_char_chat_schema' to DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpbnyv97_p/test.db...
2025-06-28 21:12:28.762 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1326 - [rag_char_chat_schema V4] Full schema script executed.
2025-06-28 21:12:28.762 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_apply_schema_v4:1332 - [rag_char_chat_schema V4] Schema 4 applied and version confirmed for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpbnyv97_p/test.db.
2025-06-28 21:12:28.762 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1357 - Migrating schema from V4 to V5 for 'rag_char_chat_schema' in DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpbnyv97_p/test.db...
2025-06-28 21:12:28.767 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1361 - [rag_char_chat_schema V4→V5] Migration script executed.
2025-06-28 21:12:28.767 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_migrate_from_v4_to_v5:1369 - [rag_char_chat_schema V4→V5] Migration completed successfully for DB: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpbnyv97_p/test.db.
2025-06-28 21:12:28.767 | INFO     | tldw_chatbook.DB.ChaChaNotes_DB:_initialize_schema:1432 - Database schema 'rag_char_chat_schema' successfully initialized/migrated to version 5.
2025-06-28 21:12:28.767 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__exit__:4114 - Transaction (outermost) committed successfully on thread 8705548032.
2025-06-28 21:12:28.767 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:__init__:996 - CharactersRAGDB initialization completed successfully for /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmpbnyv97_p/test.db
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:28.767 | DEBUG    | tldw_chatbook.DB.ChaChaNotes_DB:execute_query:1201 - Executing SQL (script=False): SELECT * FROM character_cards WHERE name = ? AND deleted = 0... Params: ('TestCharacter',)...
----------------------------------------

199. 2025-06-28 21:12:28.767 | ERROR    | tldw_chatbook.Character_Chat.Character_Chat_Lib:load_chat_history_from_file_and_save_to_db:1908 - Character 'TestCharacter' from chat log 'chat_log_stream' not found in the database.
=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/_hypothesis_pytestplugin.py:461
  /Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/_hypothesis_pytestplugin.py:461: UserWarning: Skipping collection of '.hypothesis' directory - this usually means you've explicitly set the `norecursedirs` pytest config option, replacing rather than extending the default ignores.
    warnings.warn(
----------------------------------------

200. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_attach_image_button_flow
----------------------------------------

201. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_image_path_submission_success
----------------------------------------

202. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_image_path_submission_invalid_file
----------------------------------------

203. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_clear_image_attachment
----------------------------------------

204. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_send_message_with_image
----------------------------------------

205. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_image_resizing
----------------------------------------

206. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_unsupported_file_type
----------------------------------------

207. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_image_preview_display
----------------------------------------

208. ERROR Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_multiple_image_attachments_not_allowed
----------------------------------------

209. ERROR Tests/integration/test_file_operations_with_validation.py::TestFileOperationErrorHandling::test_prepare_files_with_missing_files
----------------------------------------

210. ERROR Tests/integration/test_file_operations_with_validation.py::TestFileOperationErrorHandling::test_prepare_files_error_recovery
----------------------------------------

211. ERROR Tests/integration/test_file_operations_with_validation.py::TestFileOperationErrorHandling::test_hidden_file_validation
----------------------------------------

212. FAILED Tests/integration/test_chat_image_unit.py::TestChatMessageImageIntegration::test_image_render_mode_switching
----------------------------------------

213. FAILED Tests/integration/test_file_operations_with_validation.py::TestCharacterChatFileOperations::test_load_chat_history_with_valid_path
----------------------------------------

214. FAILED Tests/integration/test_file_operations_with_validation.py::TestCharacterChatFileOperations::test_load_chat_history_with_invalid_path
----------------------------------------

215. FAILED Tests/integration/test_file_operations_with_validation.py::TestCharacterChatFileOperations::test_load_chat_history_with_path_traversal
----------------------------------------

216. FAILED Tests/integration/test_file_operations_with_validation.py::TestCharacterChatFileOperations::test_load_chat_history_from_file_object
5 failed, 24 passed, 2 warnings, 12 errors in 3.85s
----------------------------------------

217. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_attach_image_button_flow: No details available
----------------------------------------

218. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_image_path_submission_success: No details available
----------------------------------------

219. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_image_path_submission_invalid_file: No details available
----------------------------------------

220. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_clear_image_attachment: No details available
----------------------------------------

221. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_send_message_with_image: No details available
----------------------------------------

222. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_image_resizing: No details available
----------------------------------------

223. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_unsupported_file_type: No details available
----------------------------------------

224. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_image_preview_display: No details available
----------------------------------------

225. Tests/integration/test_chat_image_integration_real.py::TestChatImageIntegration::test_multiple_image_attachments_not_allowed: No details available
----------------------------------------

226. Tests/integration/test_chat_image_unit.py::TestChatMessageImageIntegration::test_image_render_mode_switching: Tests/integration/test_chat_image_unit.py:289: in test_image_render_mode_switching
    assert message._image_widget.remove_children.call_count == 2
E   AssertionError: assert 4 == 2
E    +  where 4 = <Mock name='mock.remove_children' id='5999072688'>.call_count
E    +    where <Mock name='mock.remove_children' id='5999072688'> = <Mock id='5999072112'>.remove_children
E    +      where <Mock id='5999072112'> = ChatMessageEnhanced()._image_widget
----------------------------------------

227. Tests/integration/test_file_operations_with_validation.py::TestCharacterChatFileOperations::test_load_chat_history_with_valid_path: Tests/integration/test_file_operations_with_validation.py:69: in test_load_chat_history_with_valid_path
    assert conv_id == "conv_123"
E   AssertionError: assert None == 'conv_123'
----------------------------------------

228. Tests/integration/test_file_operations_with_validation.py::TestCharacterChatFileOperations::test_load_chat_history_with_invalid_path: Tests/integration/test_file_operations_with_validation.py:83: in test_load_chat_history_with_invalid_path
    with pytest.raises(ValueError, match="outside the allowed directory"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   Failed: DID NOT RAISE <class 'ValueError'>
----------------------------------------

229. Tests/integration/test_file_operations_with_validation.py::TestCharacterChatFileOperations::test_load_chat_history_with_path_traversal: Tests/integration/test_file_operations_with_validation.py:97: in test_load_chat_history_with_path_traversal
    with pytest.raises(ValueError, match="outside the allowed directory"):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   Failed: DID NOT RAISE <class 'ValueError'>
----------------------------------------

230. Tests/integration/test_file_operations_with_validation.py::TestCharacterChatFileOperations::test_load_chat_history_from_file_object: Tests/integration/test_file_operations_with_validation.py:120: in test_load_chat_history_from_file_object
    assert conv_id == "conv_123"
E   AssertionError: assert None == 'conv_123'
----------------------------------------

231. Tests/integration/test_file_operations_with_validation.py::TestFileOperationErrorHandling::test_prepare_files_with_missing_files: No details available
----------------------------------------

232. Tests/integration/test_file_operations_with_validation.py::TestFileOperationErrorHandling::test_prepare_files_error_recovery: No details available
----------------------------------------

233. Tests/integration/test_file_operations_with_validation.py::TestFileOperationErrorHandling::test_hidden_file_validation: No details available
----------------------------------------

================================================================================

Directory: unit
Duration: 0.50s
Passed: 2, Failed: 0, Skipped: 0, Errors: 0

================================================================================

Directory: RAG_Search
Duration: 34.27s
Passed: 86, Failed: 22, Skipped: 1, Errors: 0

Failures:

1. 2025-06-28 21:12:41.309 | ERROR    | tldw_chatbook.RAG_Search.Services.embeddings_service:get_or_create_collection:1021 - Error getting/creating collection collection_a: Validation error: metadata: Metadata cannot be empty
__________ TestLegacyCompatibility.test_chromadb_manager_integration ___________
Tests/RAG_Search/test_embeddings_integration.py:270: in test_chromadb_manager_integration
    manager = ChromaDBManager("test_user", user_config)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Embeddings/Chroma_Lib.py:250: in __init__
    f"(Provider: {default_model_spec.provider if default_model_spec else 'N/A'}). "
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'provider'
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:41.314 | INFO     | tldw_chatbook.Embeddings.Chroma_Lib:__init__:128 - Found a valid, structured [embedding_config] at the top level.
2025-06-28 21:12:41.314 | INFO     | tldw_chatbook.Embeddings.Chroma_Lib:__init__:170 - Using new embeddings service with compatibility layer
2025-06-28 21:12:41.315 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:__init__:688 - Using in-memory vector store
2025-06-28 21:12:41.315 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:initialize_from_config:776 - Set default embedding provider: test-model
2025-06-28 21:12:41.315 | INFO     | tldw_chatbook.Embeddings.Chroma_Lib:__init__:207 - ChromaDBManager for user 'test_user' path: /private/var/folders/qc/m53gw5bs70q_xf10fz52dlmw0000gn/T/tmp348cnwvc/test_user/chroma_storage
_______ TestProviderSpecificIntegration.test_provider_switching_workflow _______
Tests/RAG_Search/test_embeddings_integration.py:448: in test_provider_switching_workflow
    assert slow_time > fast_time  # Slow provider should take longer
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 3.814697265625e-06 > 8.106231689453125e-06
---------------------------- Captured stderr setup -----------------------------
2025-06-28 21:12:41.341 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set fast as current provider
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:41.341 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:set_provider:803 - Switched to provider: fast
2025-06-28 21:12:41.341 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:set_provider:803 - Switched to provider: slow
__________ TestVectorStorePerformance.test_search_performance_scaling __________
Tests/RAG_Search/test_embeddings_performance.py:252: in test_search_performance_scaling
    assert time_ratio < size_ratio * 0.5
E   assert 49.05986657303371 < (50.0 * 0.5)
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:43.191 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set test as current provider
2025-06-28 21:12:43.228 | DEBUG    | tldw_chatbook.RAG_Search.Services.embeddings_service:_add_documents_batch:1123 - Successfully added 100/100 documents in batches
2025-06-28 21:12:43.415 | DEBUG    | tldw_chatbook.RAG_Search.Services.embeddings_service:_add_documents_batch:1123 - Successfully added 500/500 documents in batches
2025-06-28 21:12:43.829 | DEBUG    | tldw_chatbook.RAG_Search.Services.embeddings_service:_add_documents_batch:1123 - Successfully added 1000/1000 documents in batches
2025-06-28 21:12:45.829 | DEBUG    | tldw_chatbook.RAG_Search.Services.embeddings_service:_add_documents_batch:1123 - Successfully added 5000/5000 documents in batches
__________________ TestMemoryPerformance.test_memory_cleanup ___________________
Tests/RAG_Search/test_embeddings_performance.py:465: in test_memory_cleanup
    assert memory_released > 0.8  # At least 80% of memory released
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert -0.0 > 0.8
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:49.334 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set test as current provider
2025-06-28 21:12:49.810 | DEBUG    | tldw_chatbook.RAG_Search.Services.embeddings_service:_add_documents_batch:1123 - Successfully added 1000/1000 documents in batches
2025-06-28 21:12:49.908 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:delete_collection:1177 - Deleted collection: temp_collection
2025-06-28 21:12:49.908 | DEBUG    | tldw_chatbook.RAG_Search.Services.embeddings_service:_cleanup_providers:1369 - Cleaned up provider: test
__________ TestPerformanceOptimizations.test_batch_size_optimization ___________
Tests/RAG_Search/test_embeddings_performance.py:501: in test_batch_size_optimization
    assert optimal_batch not in [min(batch_sizes), max(batch_sizes)]
E   assert 200 not in [10, 200]
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:50.111 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set test as current provider
2025-06-28 21:12:50.111 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:configure_performance:1268 - Performance configured: workers=4, batch_size=10, parallel=True
2025-06-28 21:12:50.257 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:configure_performance:1268 - Performance configured: workers=4, batch_size=25, parallel=True
2025-06-28 21:12:50.259 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:configure_performance:1268 - Performance configured: workers=4, batch_size=50, parallel=True
2025-06-28 21:12:50.260 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:configure_performance:1268 - Performance configured: workers=4, batch_size=100, parallel=True
2025-06-28 21:12:50.261 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:configure_performance:1268 - Performance configured: workers=4, batch_size=200, parallel=True
_________ TestEmbeddingProperties.test_embedding_dimension_consistency _________
Tests/RAG_Search/test_embeddings_properties.py:100: in test_embedding_dimension_consistency
    texts=text_batch(min_size=1, max_size=5),
           ^^^^^^^
Tests/RAG_Search/test_embeddings_properties.py:112: in test_embedding_dimension_consistency
    assert all(len(emb) == dimension for emb in embeddings)
E   assert False
E    +  where False = all(<generator object TestEmbeddingProperties.test_embedding_dimension_consistency.<locals>.<genexpr> at 0x33a896c00>)
E   Falsifying example: test_embedding_dimension_consistency(
E       self=<test_embeddings_properties.TestEmbeddingProperties object at 0x16f39fd40>,
E       texts=[''],
E       dimension=128,
E   )
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:50.410 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set test as current provider
2025-06-28 21:12:50.416 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set test as current provider
_______________ TestEmbeddingProperties.test_provider_isolation ________________
Tests/RAG_Search/test_embeddings_properties.py:152: in test_provider_isolation
    texts=text_batch(),
           ^^^^^^^
Tests/RAG_Search/test_embeddings_properties.py:174: in test_provider_isolation
    assert all(len(emb) == dimensions[i % len(dimensions)]
E   assert False
E    +  where False = all(<generator object TestEmbeddingProperties.test_provider_isolation.<locals>.<genexpr> at 0x339c98640>)
E   Falsifying example: test_provider_isolation(
E       self=<test_embeddings_properties.TestEmbeddingProperties object at 0x16f4046e0>,
E       texts=[''],
E       num_providers=2,
E   )
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:50.681 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set provider_0 as current provider
2025-06-28 21:12:50.681 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:set_provider:803 - Switched to provider: provider_0
2025-06-28 21:12:50.681 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:set_provider:803 - Switched to provider: provider_1
2025-06-28 21:12:50.686 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set provider_0 as current provider
2025-06-28 21:12:50.686 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:set_provider:803 - Switched to provider: provider_0
2025-06-28 21:12:50.686 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:set_provider:803 - Switched to provider: provider_1
__________ TestCompatibilityProperties.test_config_parsing_robustness __________
Tests/RAG_Search/test_embeddings_properties.py:510: in test_config_parsing_robustness
    config=st.fixed_dictionaries({
           ^^^^^^^
Tests/RAG_Search/test_embeddings_properties.py:534: in test_config_parsing_robustness
    with patch('tldw_chatbook.RAG_Search.Services.embeddings_service.HuggingFaceProvider'):
         ^^^^^
E   NameError: name 'patch' is not defined
E   Falsifying example: test_config_parsing_robustness(
E       self=<test_embeddings_properties.TestCompatibilityProperties object at 0x16f3d9040>,
E       config={'default_model_id': '0',
E        'models': {'0': {'provider': 'huggingface',
E          'model_name_or_path': '0',
E          'dimension': 128}}},
E   )
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:51.140 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:__init__:688 - Using in-memory vector store
2025-06-28 21:12:51.145 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:__init__:688 - Using in-memory vector store
_____________________ TestEmbeddingServiceStateful.runTest _____________________
.venv/lib/python3.12/site-packages/hypothesis/stateful.py:476: in runTest
    run_state_machine_as_test(cls, settings=self.settings)
.venv/lib/python3.12/site-packages/hypothesis/stateful.py:258: in run_state_machine_as_test
    state_machine_test(state_machine_factory)
.venv/lib/python3.12/site-packages/hypothesis/stateful.py:115: in run_state_machine
    @given(st.data())
               ^^^^^^^
E   hypothesis.errors.FailedHealthCheck: Rules should return None if they have no target bundle, but EmbeddingServiceStateMachine.add_provider returned '0'
E   See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for more information about this. If you want to disable just this health check, add HealthCheck.return_value to the suppress_health_check settings for this test.
----------------------------- Captured stderr call -----------------------------
2025-06-28 21:12:51.161 | INFO     | tldw_chatbook.RAG_Search.Services.embeddings_service:add_provider:794 - Set 0 as current provider
---------------------------------- Hypothesis ----------------------------------
You can add @seed(70553853903535345219467072607131385320) to this test or run pytest with --hypothesis-seed=70553853903535345219467072607131385320 to reproduce this failure.
______ TestRealEmbeddingsWorkflow.test_full_rag_workflow_with_real_model _______
Tests/RAG_Search/test_embeddings_real_integration.py:123: in test_full_rag_workflow_with_real_model
    vector_store = ChromaDBStore(persist_directory=str(persist_dir))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: ChromaDBStore.__init__() got an unexpected keyword argument 'persist_directory'
___________ TestRealEmbeddingsWorkflow.test_multiple_real_providers ____________
Tests/RAG_Search/test_embeddings_real_integration.py:181: in test_multiple_real_providers
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
__________ TestRealEmbeddingsWorkflow.test_real_concurrent_operations __________
Tests/RAG_Search/test_embeddings_real_integration.py:212: in test_real_concurrent_operations
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
__________ TestRealChromaDBIntegration.test_chromadb_real_persistence __________
Tests/RAG_Search/test_embeddings_real_integration.py:289: in test_chromadb_real_persistence
    service1 = EmbeddingsService(persist_directory=str(persist_dir))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
--------------------------- Captured stderr teardown ---------------------------
2025-06-28 21:12:51.205 | DEBUG    | tldw_chatbook.RAG_Search.Services.embeddings_service:_cleanup_providers:1369 - Cleaned up provider: 0
_________ TestRealChromaDBIntegration.test_chromadb_metadata_filtering _________
Tests/RAG_Search/test_embeddings_real_integration.py:330: in test_chromadb_metadata_filtering
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
___________ TestRealCacheIntegration.test_embeddings_with_real_cache ___________
Tests/RAG_Search/test_embeddings_real_integration.py:386: in test_embeddings_with_real_cache
    cache_service = CacheService(cache_dir=str(cache_dir))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/cache_service.py:65: in __init__
    self.cache_dir.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
______ TestRealMemoryManagement.test_memory_cleanup_with_real_embeddings _______
Tests/RAG_Search/test_embeddings_real_integration.py:430: in test_memory_cleanup_with_real_embeddings
    memory_service = MemoryManagementService(
E   TypeError: MemoryManagementService.__init__() got an unexpected keyword argument 'cache_size_mb'
________________ TestRealErrorHandling.test_invalid_model_name _________________
Tests/RAG_Search/test_embeddings_real_integration.py:474: in test_invalid_model_name
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
___________ TestRealErrorHandling.test_corrupted_embeddings_handling ___________
Tests/RAG_Search/test_embeddings_real_integration.py:487: in test_corrupted_embeddings_handling
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/jieba/_compat.py:18
  /Users/appledev/Working/tldw_chatbook_dev/.venv/lib/python3.12/site-packages/jieba/_compat.py:18: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
    import pkg_resources
----------------------------------------

2. FAILED Tests/RAG_Search/test_embeddings_compatibility.py::TestLegacyAPICompatibility::test_model_id_parameter
----------------------------------------

3. FAILED Tests/RAG_Search/test_embeddings_compatibility.py::TestChromaDBManagerCompatibility::test_chromadb_manager_with_new_service
----------------------------------------

4. FAILED Tests/RAG_Search/test_embeddings_compatibility.py::TestBehaviorCompatibility::test_error_handling_compatibility
----------------------------------------

5. FAILED Tests/RAG_Search/test_embeddings_integration.py::TestChromaDBIntegration::test_chromadb_collection_management
----------------------------------------

6. FAILED Tests/RAG_Search/test_embeddings_integration.py::TestLegacyCompatibility::test_chromadb_manager_integration
----------------------------------------

7. FAILED Tests/RAG_Search/test_embeddings_integration.py::TestProviderSpecificIntegration::test_provider_switching_workflow
----------------------------------------

8. FAILED Tests/RAG_Search/test_embeddings_performance.py::TestVectorStorePerformance::test_search_performance_scaling
----------------------------------------

9. FAILED Tests/RAG_Search/test_embeddings_performance.py::TestMemoryPerformance::test_memory_cleanup
----------------------------------------

10. FAILED Tests/RAG_Search/test_embeddings_performance.py::TestPerformanceOptimizations::test_batch_size_optimization
----------------------------------------

11. FAILED Tests/RAG_Search/test_embeddings_properties.py::TestEmbeddingProperties::test_embedding_dimension_consistency
----------------------------------------

12. FAILED Tests/RAG_Search/test_embeddings_properties.py::TestEmbeddingProperties::test_provider_isolation
----------------------------------------

13. FAILED Tests/RAG_Search/test_embeddings_properties.py::TestCompatibilityProperties::test_config_parsing_robustness
----------------------------------------

14. FAILED Tests/RAG_Search/test_embeddings_properties.py::TestEmbeddingServiceStateful::runTest
----------------------------------------

15. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealEmbeddingsWorkflow::test_full_rag_workflow_with_real_model
----------------------------------------

16. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealEmbeddingsWorkflow::test_multiple_real_providers
----------------------------------------

17. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealEmbeddingsWorkflow::test_real_concurrent_operations
----------------------------------------

18. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealChromaDBIntegration::test_chromadb_real_persistence
----------------------------------------

19. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealChromaDBIntegration::test_chromadb_metadata_filtering
----------------------------------------

20. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealCacheIntegration::test_embeddings_with_real_cache
----------------------------------------

21. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealMemoryManagement::test_memory_cleanup_with_real_embeddings
----------------------------------------

22. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealErrorHandling::test_invalid_model_name
----------------------------------------

23. FAILED Tests/RAG_Search/test_embeddings_real_integration.py::TestRealErrorHandling::test_corrupted_embeddings_handling
22 failed, 86 passed, 1 skipped, 2 warnings in 29.46s
----------------------------------------

24. Tests/RAG_Search/test_embeddings_compatibility.py::TestLegacyAPICompatibility::test_model_id_parameter: Tests/RAG_Search/test_embeddings_compatibility.py:102: in test_model_id_parameter
    assert len(embedding2) == 1536
E   assert 384 == 1536
E    +  where 384 = len([0.062, 0.063, 0.064, 0.065, 0.066, 0.067, ...])
----------------------------------------

25. Tests/RAG_Search/test_embeddings_compatibility.py::TestChromaDBManagerCompatibility::test_chromadb_manager_with_new_service: Tests/RAG_Search/test_embeddings_compatibility.py:151: in test_chromadb_manager_with_new_service
    manager = ChromaDBManager("test_user", user_config)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Embeddings/Chroma_Lib.py:250: in __init__
    f"(Provider: {default_model_spec.provider if default_model_spec else 'N/A'}). "
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'provider'
----------------------------------------

26. Tests/RAG_Search/test_embeddings_compatibility.py::TestBehaviorCompatibility::test_error_handling_compatibility: Tests/RAG_Search/test_embeddings_compatibility.py:304: in test_error_handling_compatibility
    with pytest.raises(RuntimeError):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   Failed: DID NOT RAISE <class 'RuntimeError'>
----------------------------------------

27. Tests/RAG_Search/test_embeddings_integration.py::TestChromaDBIntegration::test_chromadb_collection_management: Tests/RAG_Search/test_embeddings_integration.py:239: in test_chromadb_collection_management
    assert info is not None
E   assert None is not None
----------------------------------------

28. Tests/RAG_Search/test_embeddings_integration.py::TestLegacyCompatibility::test_chromadb_manager_integration: Tests/RAG_Search/test_embeddings_integration.py:270: in test_chromadb_manager_integration
    manager = ChromaDBManager("test_user", user_config)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/Embeddings/Chroma_Lib.py:250: in __init__
    f"(Provider: {default_model_spec.provider if default_model_spec else 'N/A'}). "
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'provider'
----------------------------------------

29. Tests/RAG_Search/test_embeddings_integration.py::TestProviderSpecificIntegration::test_provider_switching_workflow: Tests/RAG_Search/test_embeddings_integration.py:448: in test_provider_switching_workflow
    assert slow_time > fast_time  # Slow provider should take longer
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 3.814697265625e-06 > 8.106231689453125e-06
----------------------------------------

30. Tests/RAG_Search/test_embeddings_performance.py::TestVectorStorePerformance::test_search_performance_scaling: Tests/RAG_Search/test_embeddings_performance.py:252: in test_search_performance_scaling
    assert time_ratio < size_ratio * 0.5
E   assert 49.05986657303371 < (50.0 * 0.5)
----------------------------------------

31. Tests/RAG_Search/test_embeddings_performance.py::TestMemoryPerformance::test_memory_cleanup: Tests/RAG_Search/test_embeddings_performance.py:465: in test_memory_cleanup
    assert memory_released > 0.8  # At least 80% of memory released
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert -0.0 > 0.8
----------------------------------------

32. Tests/RAG_Search/test_embeddings_performance.py::TestPerformanceOptimizations::test_batch_size_optimization: Tests/RAG_Search/test_embeddings_performance.py:501: in test_batch_size_optimization
    assert optimal_batch not in [min(batch_sizes), max(batch_sizes)]
E   assert 200 not in [10, 200]
----------------------------------------

33. Tests/RAG_Search/test_embeddings_properties.py::TestEmbeddingProperties::test_embedding_dimension_consistency: Tests/RAG_Search/test_embeddings_properties.py:100: in test_embedding_dimension_consistency
    texts=text_batch(min_size=1, max_size=5),
           ^^^^^^^
Tests/RAG_Search/test_embeddings_properties.py:112: in test_embedding_dimension_consistency
    assert all(len(emb) == dimension for emb in embeddings)
E   assert False
E    +  where False = all(<generator object TestEmbeddingProperties.test_embedding_dimension_consistency.<locals>.<genexpr> at 0x33a896c00>)
E   Falsifying example: test_embedding_dimension_consistency(
E       self=<test_embeddings_properties.TestEmbeddingProperties object at 0x16f39fd40>,
E       texts=[''],
E       dimension=128,
E   )
----------------------------------------

34. Tests/RAG_Search/test_embeddings_properties.py::TestEmbeddingProperties::test_provider_isolation: Tests/RAG_Search/test_embeddings_properties.py:152: in test_provider_isolation
    texts=text_batch(),
           ^^^^^^^
Tests/RAG_Search/test_embeddings_properties.py:174: in test_provider_isolation
    assert all(len(emb) == dimensions[i % len(dimensions)]
E   assert False
E    +  where False = all(<generator object TestEmbeddingProperties.test_provider_isolation.<locals>.<genexpr> at 0x339c98640>)
E   Falsifying example: test_provider_isolation(
E       self=<test_embeddings_properties.TestEmbeddingProperties object at 0x16f4046e0>,
E       texts=[''],
E       num_providers=2,
E   )
----------------------------------------

35. Tests/RAG_Search/test_embeddings_properties.py::TestCompatibilityProperties::test_config_parsing_robustness: Tests/RAG_Search/test_embeddings_properties.py:510: in test_config_parsing_robustness
    config=st.fixed_dictionaries({
           ^^^^^^^
Tests/RAG_Search/test_embeddings_properties.py:534: in test_config_parsing_robustness
    with patch('tldw_chatbook.RAG_Search.Services.embeddings_service.HuggingFaceProvider'):
         ^^^^^
E   NameError: name 'patch' is not defined
E   Falsifying example: test_config_parsing_robustness(
E       self=<test_embeddings_properties.TestCompatibilityProperties object at 0x16f3d9040>,
E       config={'default_model_id': '0',
E        'models': {'0': {'provider': 'huggingface',
E          'model_name_or_path': '0',
E          'dimension': 128}}},
E   )
----------------------------------------

36. Tests/RAG_Search/test_embeddings_properties.py::TestEmbeddingServiceStateful::runTest: .venv/lib/python3.12/site-packages/hypothesis/stateful.py:476: in runTest
    run_state_machine_as_test(cls, settings=self.settings)
.venv/lib/python3.12/site-packages/hypothesis/stateful.py:258: in run_state_machine_as_test
    state_machine_test(state_machine_factory)
.venv/lib/python3.12/site-packages/hypothesis/stateful.py:115: in run_state_machine
    @given(st.data())
               ^^^^^^^
E   hypothesis.errors.FailedHealthCheck: Rules should return None if they have no target bundle, but EmbeddingServiceStateMachine.add_provider returned '0'
E   See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for more information about this. If you want to disable just this health check, add HealthCheck.return_value to the suppress_health_check settings for this test.
----------------------------------------

37. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealEmbeddingsWorkflow::test_full_rag_workflow_with_real_model: Tests/RAG_Search/test_embeddings_real_integration.py:123: in test_full_rag_workflow_with_real_model
    vector_store = ChromaDBStore(persist_directory=str(persist_dir))
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: ChromaDBStore.__init__() got an unexpected keyword argument 'persist_directory'
----------------------------------------

38. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealEmbeddingsWorkflow::test_multiple_real_providers: Tests/RAG_Search/test_embeddings_real_integration.py:181: in test_multiple_real_providers
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
----------------------------------------

39. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealEmbeddingsWorkflow::test_real_concurrent_operations: Tests/RAG_Search/test_embeddings_real_integration.py:212: in test_real_concurrent_operations
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
----------------------------------------

40. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealChromaDBIntegration::test_chromadb_real_persistence: Tests/RAG_Search/test_embeddings_real_integration.py:289: in test_chromadb_real_persistence
    service1 = EmbeddingsService(persist_directory=str(persist_dir))
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
----------------------------------------

41. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealChromaDBIntegration::test_chromadb_metadata_filtering: Tests/RAG_Search/test_embeddings_real_integration.py:330: in test_chromadb_metadata_filtering
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
----------------------------------------

42. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealCacheIntegration::test_embeddings_with_real_cache: Tests/RAG_Search/test_embeddings_real_integration.py:386: in test_embeddings_with_real_cache
    cache_service = CacheService(cache_dir=str(cache_dir))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/cache_service.py:65: in __init__
    self.cache_dir.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
----------------------------------------

43. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealMemoryManagement::test_memory_cleanup_with_real_embeddings: Tests/RAG_Search/test_embeddings_real_integration.py:430: in test_memory_cleanup_with_real_embeddings
    memory_service = MemoryManagementService(
E   TypeError: MemoryManagementService.__init__() got an unexpected keyword argument 'cache_size_mb'
----------------------------------------

44. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealErrorHandling::test_invalid_model_name: Tests/RAG_Search/test_embeddings_real_integration.py:474: in test_invalid_model_name
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
----------------------------------------

45. Tests/RAG_Search/test_embeddings_real_integration.py::TestRealErrorHandling::test_corrupted_embeddings_handling: Tests/RAG_Search/test_embeddings_real_integration.py:487: in test_corrupted_embeddings_handling
    service = EmbeddingsService(persist_directory=str(persist_dir))
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tldw_chatbook/RAG_Search/Services/embeddings_service.py:657: in __init__
    persist_directory.mkdir(parents=True, exist_ok=True)
    ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'mkdir'
----------------------------------------

================================================================================

Directory: RAG
Duration: 5.16s
Passed: 0, Failed: 0, Skipped: 0, Errors: 0

================================================================================

ANALYSIS AND RECOMMENDATIONS
================================================================================

Common Failure Patterns:
  - Database Issues: 89 occurrences
  - Attribute Errors: 48 occurrences
  - Assertion Failures: 11 occurrences
  - Key Errors: 4 occurrences
  - Import Errors: 1 occurrences

Recommendations:
  - Check that all dependencies are installed correctly
  - Verify PYTHONPATH includes the project root
  - Ensure test databases are properly initialized
  - Check for database migration issues
